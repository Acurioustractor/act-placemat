# ACT Placemat Advanced Grafana Dashboards
# Business Intelligence and Community Platform Specific Metrics

---
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboard-community-health
  namespace: monitoring
  labels:
    grafana_dashboard: "true"
data:
  community-health.json: |
    {
      "dashboard": {
        "id": null,
        "title": "ACT Placemat - Community Health Dashboard",
        "tags": ["act-placemat", "community", "health"],
        "style": "dark",
        "timezone": "Australia/Sydney",
        "editable": true,
        "hideControls": false,
        "graphTooltip": 1,
        "panels": [
          {
            "id": 1,
            "title": "Active Communities",
            "type": "stat",
            "targets": [
              {
                "expr": "sum(community_active_total)",
                "format": "time_series",
                "refId": "A"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "color": {
                  "mode": "thresholds"
                },
                "mappings": [],
                "thresholds": {
                  "steps": [
                    {"color": "red", "value": null},
                    {"color": "yellow", "value": 10},
                    {"color": "green", "value": 50}
                  ]
                },
                "unit": "short"
              }
            },
            "gridPos": {"h": 8, "w": 6, "x": 0, "y": 0}
          },
          {
            "id": 2,
            "title": "Total Community Members",
            "type": "stat",
            "targets": [
              {
                "expr": "sum(community_members_total)",
                "format": "time_series",
                "refId": "A"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "color": {
                  "mode": "thresholds"
                },
                "thresholds": {
                  "steps": [
                    {"color": "red", "value": null},
                    {"color": "yellow", "value": 100},
                    {"color": "green", "value": 500}
                  ]
                },
                "unit": "short"
              }
            },
            "gridPos": {"h": 8, "w": 6, "x": 6, "y": 0}
          },
          {
            "id": 3,
            "title": "Stories Shared Today",
            "type": "stat",
            "targets": [
              {
                "expr": "increase(stories_created_total[24h])",
                "format": "time_series",
                "refId": "A"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "color": {
                  "mode": "thresholds"
                },
                "thresholds": {
                  "steps": [
                    {"color": "red", "value": null},
                    {"color": "yellow", "value": 5},
                    {"color": "green", "value": 20}
                  ]
                },
                "unit": "short"
              }
            },
            "gridPos": {"h": 8, "w": 6, "x": 12, "y": 0}
          },
          {
            "id": 4,
            "title": "Community Engagement Rate",
            "type": "stat",
            "targets": [
              {
                "expr": "(sum(rate(community_interactions_total[24h])) / sum(community_members_total)) * 100",
                "format": "time_series",
                "refId": "A"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "color": {
                  "mode": "thresholds"
                },
                "thresholds": {
                  "steps": [
                    {"color": "red", "value": null},
                    {"color": "yellow", "value": 10},
                    {"color": "green", "value": 25}
                  ]
                },
                "unit": "percent"
              }
            },
            "gridPos": {"h": 8, "w": 6, "x": 18, "y": 0}
          },
          {
            "id": 5,
            "title": "Community Growth Over Time",
            "type": "graph",
            "targets": [
              {
                "expr": "sum(community_active_total)",
                "format": "time_series",
                "refId": "A",
                "legendFormat": "Active Communities"
              },
              {
                "expr": "sum(community_members_total)",
                "format": "time_series",
                "refId": "B",
                "legendFormat": "Total Members"
              }
            ],
            "yAxes": [
              {
                "label": "Count",
                "min": 0
              },
              {
                "label": "Members",
                "min": 0
              }
            ],
            "gridPos": {"h": 9, "w": 12, "x": 0, "y": 8}
          },
          {
            "id": 6,
            "title": "Stories by Community Type",
            "type": "piechart",
            "targets": [
              {
                "expr": "sum by (community_type) (stories_by_community_type_total)",
                "format": "time_series",
                "refId": "A"
              }
            ],
            "gridPos": {"h": 9, "w": 12, "x": 12, "y": 8}
          },
          {
            "id": 7,
            "title": "Geographic Distribution of Communities",
            "type": "worldmap",
            "targets": [
              {
                "expr": "sum by (state) (community_members_by_state_total)",
                "format": "time_series",
                "refId": "A"
              }
            ],
            "gridPos": {"h": 10, "w": 24, "x": 0, "y": 17}
          }
        ],
        "time": {
          "from": "now-24h",
          "to": "now"
        },
        "timepicker": {
          "refresh_intervals": ["5s", "10s", "30s", "1m", "5m", "15m", "30m", "1h", "2h", "1d"]
        },
        "refresh": "30s"
      }
    }

---
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboard-story-analytics
  namespace: monitoring
  labels:
    grafana_dashboard: "true"
data:
  story-analytics.json: |
    {
      "dashboard": {
        "id": null,
        "title": "ACT Placemat - Story Analytics Dashboard",
        "tags": ["act-placemat", "stories", "content"],
        "style": "dark",
        "timezone": "Australia/Sydney",
        "editable": true,
        "panels": [
          {
            "id": 1,
            "title": "Stories Created vs Viewed",
            "type": "graph",
            "targets": [
              {
                "expr": "rate(stories_created_total[5m])",
                "format": "time_series",
                "refId": "A",
                "legendFormat": "Stories Created/min"
              },
              {
                "expr": "rate(stories_viewed_total[5m])",
                "format": "time_series",
                "refId": "B",
                "legendFormat": "Stories Viewed/min"
              }
            ],
            "yAxes": [
              {
                "label": "Rate per minute",
                "min": 0
              }
            ],
            "gridPos": {"h": 8, "w": 12, "x": 0, "y": 0}
          },
          {
            "id": 2,
            "title": "Story Engagement Score",
            "type": "graph",
            "targets": [
              {
                "expr": "(sum(rate(story_comments_total[5m])) + sum(rate(story_shares_total[5m])) + sum(rate(story_likes_total[5m]))) / sum(rate(stories_viewed_total[5m]))",
                "format": "time_series",
                "refId": "A",
                "legendFormat": "Engagement Rate"
              }
            ],
            "yAxes": [
              {
                "label": "Engagement Rate",
                "min": 0,
                "max": 1
              }
            ],
            "gridPos": {"h": 8, "w": 12, "x": 12, "y": 0}
          },
          {
            "id": 3,
            "title": "Top Story Categories",
            "type": "bargauge",
            "targets": [
              {
                "expr": "topk(10, sum by (category) (stories_by_category_total))",
                "format": "time_series",
                "refId": "A"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "color": {
                  "mode": "palette-classic"
                },
                "unit": "short"
              }
            },
            "gridPos": {"h": 8, "w": 8, "x": 0, "y": 8}
          },
          {
            "id": 4,
            "title": "Story Publishing Times",
            "type": "heatmap",
            "targets": [
              {
                "expr": "sum by (hour) (stories_by_hour_total)",
                "format": "time_series",
                "refId": "A"
              }
            ],
            "gridPos": {"h": 8, "w": 16, "x": 8, "y": 8}
          },
          {
            "id": 5,
            "title": "Cultural Context in Stories",
            "type": "stat",
            "targets": [
              {
                "expr": "sum(stories_with_cultural_context_total) / sum(stories_created_total) * 100",
                "format": "time_series",
                "refId": "A"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "color": {
                  "mode": "thresholds"
                },
                "thresholds": {
                  "steps": [
                    {"color": "red", "value": null},
                    {"color": "yellow", "value": 20},
                    {"color": "green", "value": 40}
                  ]
                },
                "unit": "percent"
              }
            },
            "gridPos": {"h": 6, "w": 6, "x": 0, "y": 16}
          },
          {
            "id": 6,
            "title": "Stories Requiring Elder Review",
            "type": "stat",
            "targets": [
              {
                "expr": "sum(stories_pending_elder_review_total)",
                "format": "time_series",
                "refId": "A"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "color": {
                  "mode": "thresholds"
                },
                "thresholds": {
                  "steps": [
                    {"color": "green", "value": null},
                    {"color": "yellow", "value": 5},
                    {"color": "red", "value": 10}
                  ]
                },
                "unit": "short"
              }
            },
            "gridPos": {"h": 6, "w": 6, "x": 6, "y": 16}
          },
          {
            "id": 7,
            "title": "Average Story Reading Time",
            "type": "graph",
            "targets": [
              {
                "expr": "avg(story_reading_time_seconds)",
                "format": "time_series",
                "refId": "A",
                "legendFormat": "Average Reading Time"
              }
            ],
            "yAxes": [
              {
                "label": "Seconds",
                "min": 0
              }
            ],
            "gridPos": {"h": 6, "w": 12, "x": 12, "y": 16}
          }
        ],
        "time": {
          "from": "now-7d",
          "to": "now"
        },
        "refresh": "1m"
      }
    }

---
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboard-opportunity-insights
  namespace: monitoring
  labels:
    grafana_dashboard: "true"
data:
  opportunity-insights.json: |
    {
      "dashboard": {
        "id": null,
        "title": "ACT Placemat - Opportunity Insights Dashboard",
        "tags": ["act-placemat", "opportunities", "funding"],
        "style": "dark",
        "timezone": "Australia/Sydney",
        "editable": true,
        "panels": [
          {
            "id": 1,
            "title": "Opportunities Posted vs Applied",
            "type": "graph",
            "targets": [
              {
                "expr": "rate(opportunities_posted_total[1h])",
                "format": "time_series",
                "refId": "A",
                "legendFormat": "Posted/hour"
              },
              {
                "expr": "rate(opportunity_applications_total[1h])",
                "format": "time_series",
                "refId": "B",
                "legendFormat": "Applications/hour"
              }
            ],
            "gridPos": {"h": 8, "w": 12, "x": 0, "y": 0}
          },
          {
            "id": 2,
            "title": "Application Success Rate",
            "type": "stat",
            "targets": [
              {
                "expr": "sum(opportunity_applications_successful_total) / sum(opportunity_applications_total) * 100",
                "format": "time_series",
                "refId": "A"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "color": {
                  "mode": "thresholds"
                },
                "thresholds": {
                  "steps": [
                    {"color": "red", "value": null},
                    {"color": "yellow", "value": 10},
                    {"color": "green", "value": 25}
                  ]
                },
                "unit": "percent"
              }
            },
            "gridPos": {"h": 8, "w": 6, "x": 12, "y": 0}
          },
          {
            "id": 3,
            "title": "Total Funding Available",
            "type": "stat",
            "targets": [
              {
                "expr": "sum(opportunity_funding_amount_total)",
                "format": "time_series",
                "refId": "A"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "color": {
                  "mode": "palette-classic"
                },
                "unit": "currencyAUD"
              }
            },
            "gridPos": {"h": 8, "w": 6, "x": 18, "y": 0}
          },
          {
            "id": 4,
            "title": "Opportunities by Category",
            "type": "piechart",
            "targets": [
              {
                "expr": "sum by (category) (opportunities_by_category_total)",
                "format": "time_series",
                "refId": "A"
              }
            ],
            "gridPos": {"h": 8, "w": 12, "x": 0, "y": 8}
          },
          {
            "id": 5,
            "title": "Geographic Distribution of Opportunities",
            "type": "bargauge",
            "targets": [
              {
                "expr": "sum by (state) (opportunities_by_state_total)",
                "format": "time_series",
                "refId": "A"
              }
            ],
            "gridPos": {"h": 8, "w": 12, "x": 12, "y": 8}
          },
          {
            "id": 6,
            "title": "Community Benefit Score",
            "type": "gauge",
            "targets": [
              {
                "expr": "avg(opportunity_community_benefit_score)",
                "format": "time_series",
                "refId": "A"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "color": {
                  "mode": "thresholds"
                },
                "thresholds": {
                  "steps": [
                    {"color": "red", "value": null},
                    {"color": "yellow", "value": 0.4},
                    {"color": "green", "value": 0.7}
                  ]
                },
                "min": 0,
                "max": 1
              }
            },
            "gridPos": {"h": 6, "w": 8, "x": 0, "y": 16}
          },
          {
            "id": 7,
            "title": "Opportunities Expiring Soon",
            "type": "table",
            "targets": [
              {
                "expr": "sort_desc(opportunity_days_until_deadline{days_until_deadline<30})",
                "format": "table",
                "refId": "A"
              }
            ],
            "gridPos": {"h": 6, "w": 16, "x": 8, "y": 16}
          }
        ],
        "time": {
          "from": "now-30d",
          "to": "now"
        },
        "refresh": "5m"
      }
    }

---
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboard-user-experience
  namespace: monitoring
  labels:
    grafana_dashboard: "true"
data:
  user-experience.json: |
    {
      "dashboard": {
        "id": null,
        "title": "ACT Placemat - User Experience Dashboard",
        "tags": ["act-placemat", "ux", "performance"],
        "style": "dark",
        "timezone": "Australia/Sydney",
        "editable": true,
        "panels": [
          {
            "id": 1,
            "title": "Page Load Times",
            "type": "graph",
            "targets": [
              {
                "expr": "histogram_quantile(0.50, rate(http_request_duration_seconds_bucket[5m]))",
                "format": "time_series",
                "refId": "A",
                "legendFormat": "50th percentile"
              },
              {
                "expr": "histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m]))",
                "format": "time_series",
                "refId": "B",
                "legendFormat": "95th percentile"
              },
              {
                "expr": "histogram_quantile(0.99, rate(http_request_duration_seconds_bucket[5m]))",
                "format": "time_series",
                "refId": "C",
                "legendFormat": "99th percentile"
              }
            ],
            "yAxes": [
              {
                "label": "Response Time (s)",
                "min": 0
              }
            ],
            "gridPos": {"h": 8, "w": 12, "x": 0, "y": 0}
          },
          {
            "id": 2,
            "title": "Error Rate",
            "type": "graph",
            "targets": [
              {
                "expr": "rate(http_requests_total{status=~\"5..\"}[5m]) / rate(http_requests_total[5m]) * 100",
                "format": "time_series",
                "refId": "A",
                "legendFormat": "5xx Error Rate"
              },
              {
                "expr": "rate(http_requests_total{status=~\"4..\"}[5m]) / rate(http_requests_total[5m]) * 100",
                "format": "time_series",
                "refId": "B",
                "legendFormat": "4xx Error Rate"
              }
            ],
            "yAxes": [
              {
                "label": "Error Rate (%)",
                "min": 0
              }
            ],
            "gridPos": {"h": 8, "w": 12, "x": 12, "y": 0}
          },
          {
            "id": 3,
            "title": "Active Users",
            "type": "graph",
            "targets": [
              {
                "expr": "sum(user_sessions_active_total)",
                "format": "time_series",
                "refId": "A",
                "legendFormat": "Active Sessions"
              },
              {
                "expr": "sum(increase(user_logins_total[1h]))",
                "format": "time_series",
                "refId": "B",
                "legendFormat": "Logins/hour"
              }
            ],
            "gridPos": {"h": 8, "w": 12, "x": 0, "y": 8}
          },
          {
            "id": 4,
            "title": "User Journey Completion",
            "type": "graph",
            "targets": [
              {
                "expr": "rate(user_journey_story_creation_completed_total[5m])",
                "format": "time_series",
                "refId": "A",
                "legendFormat": "Story Creation"
              },
              {
                "expr": "rate(user_journey_community_join_completed_total[5m])",
                "format": "time_series",
                "refId": "B",
                "legendFormat": "Community Join"
              },
              {
                "expr": "rate(user_journey_opportunity_application_completed_total[5m])",
                "format": "time_series",
                "refId": "C",
                "legendFormat": "Opportunity Application"
              }
            ],
            "gridPos": {"h": 8, "w": 12, "x": 12, "y": 8}
          },
          {
            "id": 5,
            "title": "Mobile vs Desktop Usage",
            "type": "piechart",
            "targets": [
              {
                "expr": "sum by (device_type) (user_sessions_by_device_total)",
                "format": "time_series",
                "refId": "A"
              }
            ],
            "gridPos": {"h": 8, "w": 8, "x": 0, "y": 16}
          },
          {
            "id": 6,
            "title": "User Accessibility Features Usage",
            "type": "bargauge",
            "targets": [
              {
                "expr": "sum by (feature) (accessibility_features_used_total)",
                "format": "time_series",
                "refId": "A"
              }
            ],
            "gridPos": {"h": 8, "w": 8, "x": 8, "y": 16}
          },
          {
            "id": 7,
            "title": "User Satisfaction Score",
            "type": "gauge",
            "targets": [
              {
                "expr": "avg(user_satisfaction_score)",
                "format": "time_series",
                "refId": "A"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "color": {
                  "mode": "thresholds"
                },
                "thresholds": {
                  "steps": [
                    {"color": "red", "value": null},
                    {"color": "yellow", "value": 3},
                    {"color": "green", "value": 4}
                  ]
                },
                "min": 1,
                "max": 5
              }
            },
            "gridPos": {"h": 8, "w": 8, "x": 16, "y": 16}
          }
        ],
        "time": {
          "from": "now-24h",
          "to": "now"
        },
        "refresh": "30s"
      }
    }

---
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboard-cultural-protocols
  namespace: monitoring
  labels:
    grafana_dashboard: "true"
data:
  cultural-protocols.json: |
    {
      "dashboard": {
        "id": null,
        "title": "ACT Placemat - Cultural Protocols & Compliance",
        "tags": ["act-placemat", "cultural", "compliance"],
        "style": "dark",
        "timezone": "Australia/Sydney",
        "editable": true,
        "panels": [
          {
            "id": 1,
            "title": "Cultural Protocol Compliance Rate",
            "type": "stat",
            "targets": [
              {
                "expr": "sum(cultural_protocol_compliant_actions_total) / sum(cultural_protocol_required_actions_total) * 100",
                "format": "time_series",
                "refId": "A"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "color": {
                  "mode": "thresholds"
                },
                "thresholds": {
                  "steps": [
                    {"color": "red", "value": null},
                    {"color": "yellow", "value": 85},
                    {"color": "green", "value": 95}
                  ]
                },
                "unit": "percent"
              }
            },
            "gridPos": {"h": 8, "w": 6, "x": 0, "y": 0}
          },
          {
            "id": 2,
            "title": "Elder Consultation Requests",
            "type": "graph",
            "targets": [
              {
                "expr": "rate(elder_consultation_requests_total[1h])",
                "format": "time_series",
                "refId": "A",
                "legendFormat": "Requests/hour"
              },
              {
                "expr": "rate(elder_consultation_completed_total[1h])",
                "format": "time_series",
                "refId": "B",
                "legendFormat": "Completed/hour"
              }
            ],
            "gridPos": {"h": 8, "w": 9, "x": 6, "y": 0}
          },
          {
            "id": 3,
            "title": "Pending Elder Reviews",
            "type": "stat",
            "targets": [
              {
                "expr": "sum(elder_review_pending_total)",
                "format": "time_series",
                "refId": "A"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "color": {
                  "mode": "thresholds"
                },
                "thresholds": {
                  "steps": [
                    {"color": "green", "value": null},
                    {"color": "yellow", "value": 5},
                    {"color": "red", "value": 10}
                  ]
                },
                "unit": "short"
              }
            },
            "gridPos": {"h": 8, "w": 9, "x": 15, "y": 0}
          },
          {
            "id": 4,
            "title": "Cultural Framework Usage",
            "type": "piechart",
            "targets": [
              {
                "expr": "sum by (framework) (cultural_frameworks_used_total)",
                "format": "time_series",
                "refId": "A"
              }
            ],
            "gridPos": {"h": 8, "w": 12, "x": 0, "y": 8}
          },
          {
            "id": 5,
            "title": "Data Sovereignty Compliance",
            "type": "bargauge",
            "targets": [
              {
                "expr": "sum by (community_type) (data_sovereignty_compliant_total) / sum by (community_type) (data_sovereignty_required_total) * 100",
                "format": "time_series",
                "refId": "A"
              }
            ],
            "fieldConfig": {
              "defaults": {
                "color": {
                  "mode": "thresholds"
                },
                "thresholds": {
                  "steps": [
                    {"color": "red", "value": null},
                    {"color": "yellow", "value": 90},
                    {"color": "green", "value": 98}
                  ]
                },
                "unit": "percent"
              }
            },
            "gridPos": {"h": 8, "w": 12, "x": 12, "y": 8}
          },
          {
            "id": 6,
            "title": "Free Prior Informed Consent (FPIC) Status",
            "type": "table",
            "targets": [
              {
                "expr": "fpic_consent_status",
                "format": "table",
                "refId": "A"
              }
            ],
            "gridPos": {"h": 8, "w": 12, "x": 0, "y": 16}
          },
          {
            "id": 7,
            "title": "Cultural Knowledge Sharing Approval Time",
            "type": "graph",
            "targets": [
              {
                "expr": "histogram_quantile(0.50, rate(cultural_knowledge_approval_duration_seconds_bucket[5m]))",
                "format": "time_series",
                "refId": "A",
                "legendFormat": "Median approval time"
              },
              {
                "expr": "histogram_quantile(0.95, rate(cultural_knowledge_approval_duration_seconds_bucket[5m]))",
                "format": "time_series",
                "refId": "B",
                "legendFormat": "95th percentile"
              }
            ],
            "yAxes": [
              {
                "label": "Time (seconds)",
                "min": 0
              }
            ],
            "gridPos": {"h": 8, "w": 12, "x": 12, "y": 16}
          }
        ],
        "time": {
          "from": "now-7d",
          "to": "now"
        },
        "refresh": "1m"
      }
    }

---
# Update Grafana deployment to include dashboard provisioning
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboard-provider
  namespace: monitoring
data:
  dashboards.yml: |
    apiVersion: 1
    providers:
    - name: 'ACT Placemat Dashboards'
      orgId: 1
      folder: 'ACT Placemat'
      type: file
      disableDeletion: false
      allowUiUpdates: true
      options:
        path: /var/lib/grafana/dashboards

---
# Enhanced Grafana configuration with ACT Placemat branding
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-config
  namespace: monitoring
data:
  grafana.ini: |
    [analytics]
    check_for_updates = false
    reporting_enabled = false

    [security]
    admin_user = admin
    cookie_secure = true
    cookie_samesite = strict

    [server]
    protocol = http
    http_port = 3000
    domain = monitoring.actplacemat.org.au
    root_url = https://monitoring.actplacemat.org.au/grafana

    [auth]
    disable_login_form = false
    disable_signout_menu = false

    [auth.anonymous]
    enabled = false

    [database]
    type = sqlite3
    path = grafana.db

    [session]
    provider = memory

    [alerting]
    enabled = true

    [unified_alerting]
    enabled = true

    [log]
    mode = console
    level = info

    [panels]
    enable_alpha = true

    [feature_toggles]
    enable = publicDashboards

    [branding]
    app_title = "ACT Placemat Monitoring"
    footer_links = "footer"
    fav_icon = "public/img/fav32.png"
    apple_touch_icon = "public/img/apple-touch-icon.png"