# ACT Placemat Business KPI Alerts
# Community health, engagement, and platform success metrics

---
apiVersion: v1
kind: ConfigMap
metadata:
  name: business-kpi-alerts
  namespace: monitoring
  labels:
    prometheus: kube-prometheus
    role: alert-rules
data:
  business-kpis.yml: |
    groups:
    # ========================================
    # COMMUNITY HEALTH & ENGAGEMENT KPIs
    # ========================================
    - name: community-health-kpis
      interval: 1m
      rules:
      
      # Community Growth Metrics
      - record: community:growth_rate_7d
        expr: (community_members_total - community_members_total offset 7d) / community_members_total offset 7d * 100
      
      - record: community:new_communities_24h
        expr: increase(communities_created_total[24h])
      
      - record: community:active_communities_percentage
        expr: community_active_total / community_total * 100
      
      # Engagement Metrics  
      - record: community:engagement_rate_24h
        expr: increase(community_interactions_total[24h]) / community_members_total
      
      - record: community:average_session_duration_minutes
        expr: avg(user_session_duration_seconds) / 60
      
      - record: community:daily_active_users
        expr: count(increase(user_login_total[24h]) > 0)
      
      # Content Creation Metrics
      - record: stories:creation_rate_24h
        expr: increase(stories_created_total[24h])
      
      - record: stories:engagement_score
        expr: (increase(story_views_total[24h]) + increase(story_comments_total[24h]) * 3 + increase(story_shares_total[24h]) * 5) / increase(stories_created_total[24h])
      
      - record: stories:cultural_content_percentage
        expr: increase(stories_with_cultural_context_total[24h]) / increase(stories_created_total[24h]) * 100

      # KPI Alerts
      - alert: CommunityGrowthStagnant
        expr: community:growth_rate_7d < 2
        for: 24h
        labels:
          severity: warning
          category: growth
          team: community-management
          kpi: community_growth
        annotations:
          summary: "Community growth has stagnated"
          description: "Community growth rate is {{ $value | humanizePercentage }} over the last 7 days (target: >2%)"
          impact: "Platform expansion and reach may be limited"
          action: "Review onboarding process, marketing campaigns, and community outreach"
          dashboard: "https://monitoring.actplacemat.org.au/grafana/d/community-growth"
      
      - alert: LowCommunityEngagement
        expr: community:engagement_rate_24h < 0.1
        for: 4h
        labels:
          severity: warning
          category: engagement
          team: community-management
          kpi: engagement_rate
        annotations:
          summary: "Community engagement is below target"
          description: "Daily engagement rate is {{ $value | humanizePercentage }} (target: >10%)"
          impact: "Community health and retention may decline"
          action: "Review content strategy, community events, and user experience"
          dashboard: "https://monitoring.actplacemat.org.au/grafana/d/community-engagement"
      
      - alert: CommunityChurnHigh
        expr: rate(community_members_left_total[24h]) / community_members_total > 0.05
        for: 2h
        labels:
          severity: critical
          category: retention
          team: community-management
          kpi: churn_rate
        annotations:
          summary: "High community member churn detected"
          description: "Daily churn rate is {{ $value | humanizePercentage }} (target: <5%)"
          impact: "Community sustainability at risk"
          action: "Immediate investigation into member satisfaction and platform issues"
          dashboard: "https://monitoring.actplacemat.org.au/grafana/d/community-retention"
      
      - alert: StoryCreationDecline
        expr: stories:creation_rate_24h < 10
        for: 6h
        labels:
          severity: warning
          category: content
          team: content-strategy
          kpi: content_creation
        annotations:
          summary: "Story creation rate has declined"
          description: "Only {{ $value }} stories created in the last 24 hours (target: >10)"
          impact: "Platform content freshness and community engagement may suffer"
          action: "Review content incentives, creation tools, and user onboarding"
          dashboard: "https://monitoring.actplacemat.org.au/grafana/d/story-analytics"
      
      - alert: LowCulturalContentEngagement
        expr: stories:cultural_content_percentage < 30
        for: 12h
        labels:
          severity: warning
          category: cultural
          team: cultural-advisors
          kpi: cultural_engagement
        annotations:
          summary: "Cultural content representation is below target"
          description: "Cultural content is {{ $value | humanizePercentage }} of daily stories (target: >30%)"
          impact: "Platform cultural mission alignment may be weakening"
          action: "Engage with cultural advisors and community leaders"
          dashboard: "https://monitoring.actplacemat.org.au/grafana/d/cultural-content"

    # ========================================
    # OPPORTUNITY & ECONOMIC IMPACT KPIs
    # ========================================
    - name: opportunity-economic-kpis
      interval: 5m
      rules:
      
      # Opportunity Metrics
      - record: opportunities:application_success_rate
        expr: opportunities_successful_total / opportunity_applications_total * 100
      
      - record: opportunities:average_funding_amount
        expr: avg(opportunity_funding_amount)
      
      - record: opportunities:community_benefit_score
        expr: avg(opportunity_community_benefit_score)
      
      # Economic Impact Metrics
      - record: economics:total_funding_distributed_24h
        expr: increase(funding_distributed_total[24h])
      
      - record: economics:community_share_percentage
        expr: community_benefit_share_total / total_economic_value_total * 100
      
      - record: economics:average_transaction_size
        expr: avg(transaction_amount)

      # Opportunity KPI Alerts
      - alert: LowOpportunityApplicationRate
        expr: rate(opportunity_applications_total[24h]) < 5
        for: 8h
        labels:
          severity: warning
          category: opportunities
          team: partnerships
          kpi: application_rate
        annotations:
          summary: "Opportunity application rate is below target"
          description: "Only {{ $value }} applications in 24 hours (target: >5)"
          impact: "Community economic empowerment may be limited"
          action: "Review opportunity matching algorithms and user notifications"
          dashboard: "https://monitoring.actplacemat.org.au/grafana/d/opportunities"
      
      - alert: OpportunitySuccessRateLow
        expr: opportunities:application_success_rate < 20
        for: 24h
        labels:
          severity: warning
          category: opportunities
          team: partnerships
          kpi: success_rate
        annotations:
          summary: "Opportunity application success rate is low"
          description: "Success rate is {{ $value | humanizePercentage }} (target: >20%)"
          impact: "User confidence in platform opportunities may decline"
          action: "Review opportunity quality, application guidance, and partner engagement"
          dashboard: "https://monitoring.actplacemat.org.au/grafana/d/opportunity-success"
      
      - alert: CommunityBenefitShareBelowTarget
        expr: economics:community_share_percentage < 40
        for: 1h
        labels:
          severity: critical
          category: economics
          team: governance
          kpi: community_benefit_share
        annotations:
          summary: "Community benefit share below committed threshold"
          description: "Community share is {{ $value | humanizePercentage }} (committed: >40%)"
          impact: "Platform governance and community trust at risk"
          action: "Immediate review of benefit distribution mechanisms"
          dashboard: "https://monitoring.actplacemat.org.au/grafana/d/benefit-sharing"
      
      - alert: EconomicActivityStagnant
        expr: economics:total_funding_distributed_24h < 1000
        for: 48h
        labels:
          severity: warning
          category: economics
          team: partnerships
          kpi: economic_activity
        annotations:
          summary: "Economic activity on platform is stagnant"
          description: "Only ${{ $value }} distributed in 24 hours (target: >$1000)"
          impact: "Platform economic mission effectiveness reduced"
          action: "Engage with funding partners and review opportunity pipeline"
          dashboard: "https://monitoring.actplacemat.org.au/grafana/d/economic-impact"

    # ========================================
    # USER EXPERIENCE & ACCESSIBILITY KPIs
    # ========================================
    - name: user-experience-kpis
      interval: 1m
      rules:
      
      # User Experience Metrics
      - record: ux:page_load_time_p95
        expr: histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m]))
      
      - record: ux:bounce_rate_24h
        expr: increase(user_sessions_bounced_total[24h]) / increase(user_sessions_total[24h]) * 100
      
      - record: ux:user_satisfaction_score
        expr: avg(user_satisfaction_rating)
      
      # Accessibility Metrics
      - record: accessibility:feature_usage_rate
        expr: increase(accessibility_features_used_total[24h]) / increase(user_sessions_total[24h]) * 100
      
      - record: accessibility:compliance_score
        expr: avg(accessibility_compliance_score)

      # User Experience KPI Alerts
      - alert: HighPageLoadTimes
        expr: ux:page_load_time_p95 > 3
        for: 15m
        labels:
          severity: warning
          category: performance
          team: frontend
          kpi: page_load_time
        annotations:
          summary: "Page load times are above target"
          description: "95th percentile load time is {{ $value }}s (target: <3s)"
          impact: "User experience and engagement may be negatively affected"
          action: "Review frontend performance, CDN configuration, and optimize critical rendering path"
          dashboard: "https://monitoring.actplacemat.org.au/grafana/d/user-experience"
      
      - alert: HighBounceRate
        expr: ux:bounce_rate_24h > 60
        for: 2h
        labels:
          severity: warning
          category: engagement
          team: design
          kpi: bounce_rate
        annotations:
          summary: "High user bounce rate detected"
          description: "Bounce rate is {{ $value | humanizePercentage }} (target: <60%)"
          impact: "User engagement and platform adoption may be hindered"
          action: "Review landing page design, content relevance, and user onboarding flow"
          dashboard: "https://monitoring.actplacemat.org.au/grafana/d/user-behavior"
      
      - alert: LowUserSatisfaction
        expr: ux:user_satisfaction_score < 3.5
        for: 24h
        labels:
          severity: critical
          category: satisfaction
          team: product
          kpi: user_satisfaction
        annotations:
          summary: "User satisfaction score is below acceptable threshold"
          description: "Average satisfaction is {{ $value }}/5 (target: >3.5)"
          impact: "Platform adoption and community retention at risk"
          action: "Conduct user research, review feedback, and prioritize UX improvements"
          dashboard: "https://monitoring.actplacemat.org.au/grafana/d/user-satisfaction"
      
      - alert: AccessibilityComplianceLow
        expr: accessibility:compliance_score < 0.8
        for: 1h
        labels:
          severity: warning
          category: accessibility
          team: frontend
          kpi: accessibility_compliance
        annotations:
          summary: "Accessibility compliance score below target"
          description: "Compliance score is {{ $value | humanizePercentage }} (target: >80%)"
          impact: "Platform accessibility and inclusivity compromised"
          action: "Review accessibility features, conduct audit, and prioritize fixes"
          dashboard: "https://monitoring.actplacemat.org.au/grafana/d/accessibility"

    # ========================================
    # CULTURAL PROTOCOL & GOVERNANCE KPIs
    # ========================================
    - name: cultural-governance-kpis
      interval: 30s
      rules:
      
      # Cultural Compliance Metrics
      - record: cultural:protocol_compliance_rate
        expr: cultural_protocol_compliant_actions_total / cultural_protocol_required_actions_total * 100
      
      - record: cultural:elder_review_completion_time_median
        expr: histogram_quantile(0.5, rate(elder_review_duration_seconds_bucket[1h]))
      
      - record: cultural:data_sovereignty_compliance_rate
        expr: data_sovereignty_compliant_requests_total / data_sovereignty_required_requests_total * 100
      
      # Governance Metrics
      - record: governance:community_participation_rate
        expr: governance_participants_total / community_members_total * 100
      
      - record: governance:decision_consensus_rate
        expr: governance_consensus_decisions_total / governance_total_decisions_total * 100

      # Cultural & Governance KPI Alerts
      - alert: CulturalComplianceBelow95Percent
        expr: cultural:protocol_compliance_rate < 95
        for: 30m
        labels:
          severity: critical
          category: cultural
          team: cultural-advisors
          kpi: cultural_compliance
        annotations:
          summary: "Cultural protocol compliance below critical threshold"
          description: "Compliance rate is {{ $value | humanizePercentage }} (required: >95%)"
          impact: "Platform cultural integrity and community trust at risk"
          action: "Immediate review of cultural protocols and staff training"
          dashboard: "https://monitoring.actplacemat.org.au/grafana/d/cultural-compliance"
      
      - alert: ElderReviewBacklogExcessive
        expr: elder_review_pending_total > 10
        for: 4h
        labels:
          severity: warning
          category: cultural
          team: cultural-advisors
          kpi: elder_review_timeliness
        annotations:
          summary: "Elder review backlog is excessive"
          description: "{{ $value }} items pending review for over 4 hours"
          impact: "Cultural content approval process may be delayed"
          action: "Engage additional cultural advisors or review workload distribution"
          dashboard: "https://monitoring.actplacemat.org.au/grafana/d/elder-reviews"
      
      - alert: DataSovereigntyCompromised
        expr: cultural:data_sovereignty_compliance_rate < 98
        for: 1h
        labels:
          severity: critical
          category: sovereignty
          team: legal
          kpi: data_sovereignty
        annotations:
          summary: "Data sovereignty compliance compromised"
          description: "Compliance rate is {{ $value | humanizePercentage }} (required: >98%)"
          impact: "Legal and ethical obligations to Indigenous communities may be violated"
          action: "Immediate audit of data handling practices and system configurations"
          dashboard: "https://monitoring.actplacemat.org.au/grafana/d/data-sovereignty"
      
      - alert: LowCommunityGovernanceParticipation
        expr: governance:community_participation_rate < 15
        for: 7d
        labels:
          severity: warning
          category: governance
          team: governance
          kpi: governance_participation
        annotations:
          summary: "Low community participation in governance decisions"
          description: "Participation rate is {{ $value | humanizePercentage }} (target: >15%)"
          impact: "Democratic governance and community ownership may be weakened"
          action: "Review governance processes, increase transparency, and improve engagement"
          dashboard: "https://monitoring.actplacemat.org.au/grafana/d/governance-participation"

    # ========================================
    # PLATFORM SUSTAINABILITY KPIs
    # ========================================
    - name: sustainability-kpis
      interval: 5m
      rules:
      
      # Sustainability Metrics
      - record: sustainability:user_retention_rate_30d
        expr: (community_members_total - increase(community_members_left_total[30d])) / community_members_total * 100
      
      - record: sustainability:revenue_per_community_member
        expr: total_platform_revenue / community_members_total
      
      - record: sustainability:cost_per_active_user
        expr: total_platform_costs / community_active_users_total
      
      - record: sustainability:platform_efficiency_score
        expr: total_platform_value_generated / total_platform_costs

      # Sustainability KPI Alerts
      - alert: UserRetentionBelowTarget
        expr: sustainability:user_retention_rate_30d < 80
        for: 24h
        labels:
          severity: warning
          category: sustainability
          team: product
          kpi: user_retention
        annotations:
          summary: "User retention rate below sustainability target"
          description: "30-day retention is {{ $value | humanizePercentage }} (target: >80%)"
          impact: "Long-term platform viability may be at risk"
          action: "Analyze churn reasons and improve user experience and value proposition"
          dashboard: "https://monitoring.actplacemat.org.au/grafana/d/sustainability"
      
      - alert: PlatformEfficiencyLow
        expr: sustainability:platform_efficiency_score < 2
        for: 48h
        labels:
          severity: warning
          category: efficiency
          team: operations
          kpi: platform_efficiency
        annotations:
          summary: "Platform efficiency score below optimal range"
          description: "Efficiency score is {{ $value }} (target: >2.0)"
          impact: "Platform resource utilization and value generation suboptimal"
          action: "Review operational costs, optimize infrastructure, and analyze value creation"
          dashboard: "https://monitoring.actplacemat.org.au/grafana/d/platform-efficiency"

---
# Business KPI Dashboard Configuration
apiVersion: v1
kind: ConfigMap
metadata:
  name: business-kpi-dashboard-config
  namespace: monitoring
data:
  kpi-dashboard.json: |
    {
      "dashboard": {
        "id": null,
        "title": "ACT Placemat - Business KPI Dashboard",
        "tags": ["act-placemat", "kpi", "business"],
        "style": "dark",
        "timezone": "Australia/Sydney",
        "refresh": "1m",
        "panels": [
          {
            "title": "Community Growth Rate (7 days)",
            "type": "gauge",
            "targets": [{"expr": "community:growth_rate_7d"}],
            "fieldConfig": {
              "defaults": {
                "unit": "percent",
                "min": 0,
                "max": 20,
                "thresholds": {
                  "steps": [
                    {"color": "red", "value": 0},
                    {"color": "yellow", "value": 2},
                    {"color": "green", "value": 5}
                  ]
                }
              }
            },
            "gridPos": {"h": 8, "w": 6, "x": 0, "y": 0}
          },
          {
            "title": "Community Engagement Rate",
            "type": "gauge",
            "targets": [{"expr": "community:engagement_rate_24h"}],
            "fieldConfig": {
              "defaults": {
                "unit": "percentunit",
                "min": 0,
                "max": 0.5,
                "thresholds": {
                  "steps": [
                    {"color": "red", "value": 0},
                    {"color": "yellow", "value": 0.1},
                    {"color": "green", "value": 0.2}
                  ]
                }
              }
            },
            "gridPos": {"h": 8, "w": 6, "x": 6, "y": 0}
          },
          {
            "title": "Cultural Compliance Rate",
            "type": "gauge",
            "targets": [{"expr": "cultural:protocol_compliance_rate"}],
            "fieldConfig": {
              "defaults": {
                "unit": "percent",
                "min": 90,
                "max": 100,
                "thresholds": {
                  "steps": [
                    {"color": "red", "value": 90},
                    {"color": "yellow", "value": 95},
                    {"color": "green", "value": 98}
                  ]
                }
              }
            },
            "gridPos": {"h": 8, "w": 6, "x": 12, "y": 0}
          },
          {
            "title": "User Satisfaction Score",
            "type": "gauge",
            "targets": [{"expr": "ux:user_satisfaction_score"}],
            "fieldConfig": {
              "defaults": {
                "unit": "short",
                "min": 1,
                "max": 5,
                "thresholds": {
                  "steps": [
                    {"color": "red", "value": 1},
                    {"color": "yellow", "value": 3.5},
                    {"color": "green", "value": 4}
                  ]
                }
              }
            },
            "gridPos": {"h": 8, "w": 6, "x": 18, "y": 0}
          }
        ]
      }
    }