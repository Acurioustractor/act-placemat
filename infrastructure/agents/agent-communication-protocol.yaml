# Agent Communication Protocol and Message Formats
# LangGraph agent-to-agent communication with Australian compliance

---
# Agent Communication Protocol Configuration
apiVersion: v1
kind: ConfigMap
metadata:
  name: agent-communication-protocol
  namespace: act-placemat
  labels:
    component: agents
    service-type: communication-protocol
    data-residency: australia
  annotations:
    description: "Agent communication protocol for LangGraph multi-agent system"
    compliance.framework: "australian-privacy-act"
data:
  protocol_specification.yaml: |
    # Agent Communication Protocol Specification
    protocol:
      version: "1.0.0"
      name: "ACT-Placemat-Agent-Protocol"
      compliance_framework: "australian-privacy-act"
      data_residency: "australia"
      
      # Message format specification
      message_format:
        envelope:
          required_fields:
            - message_id: "UUID v4 unique identifier"
            - message_type: "Enum: task_request, task_response, handoff, coordination, status_update, error_notification"
            - sender_id: "Agent identifier"
            - recipient_id: "Target agent identifier or 'broadcast'"
            - timestamp: "ISO 8601 timestamp in Australian timezone"
            - protocol_version: "Protocol version for compatibility"
            
          optional_fields:
            - correlation_id: "UUID for related message chains"
            - reply_to: "Return path for responses"
            - priority: "Integer 1-10 (10=highest)"
            - expires_at: "ISO 8601 expiration timestamp"
            - retry_count: "Number of retry attempts"
            - trace_id: "Distributed tracing identifier"
            - workflow_id: "Associated workflow identifier"
            
        payload:
          structure:
            data: "Message-specific data object"
            metadata: "Additional context and routing information"
            compliance: "Australian compliance and audit fields"
            
      # Agent types and capabilities
      agent_types:
        financial_intelligence:
          agent_id_prefix: "fi-"
          capabilities:
            - "financial_analysis"
            - "risk_assessment" 
            - "compliance_checking"
            - "regulatory_reporting"
          communication_patterns:
            - "request_response"
            - "publish_subscribe"
            - "workflow_coordination"
          message_types:
            outbound: ["task_request", "analysis_result", "compliance_alert"]
            inbound: ["task_assignment", "data_request", "coordination"]
            
        research_analyst:
          agent_id_prefix: "ra-"
          capabilities:
            - "policy_research"
            - "data_collection"
            - "market_analysis"
            - "trend_identification"
          communication_patterns:
            - "request_response"
            - "data_streaming"
            - "collaborative_research"
          message_types:
            outbound: ["research_request", "data_findings", "analysis_update"]
            inbound: ["research_assignment", "data_query", "peer_collaboration"]
            
        compliance_officer:
          agent_id_prefix: "co-"
          capabilities:
            - "regulatory_compliance"
            - "audit_validation"
            - "privacy_assessment"
            - "policy_enforcement"
          communication_patterns:
            - "audit_trail"
            - "policy_broadcast"
            - "compliance_validation"
          message_types:
            outbound: ["compliance_result", "audit_report", "policy_update"]
            inbound: ["compliance_request", "audit_trigger", "policy_query"]
            
        community_coordinator:
          agent_id_prefix: "cc-"
          capabilities:
            - "stakeholder_coordination"
            - "workflow_orchestration"
            - "consensus_building"
            - "communication_facilitation"
          communication_patterns:
            - "orchestration"
            - "multicast"
            - "consensus_protocol"
          message_types:
            outbound: ["coordination_request", "workflow_update", "consensus_proposal"]
            inbound: ["stakeholder_input", "workflow_status", "consensus_response"]

      # Message delivery semantics
      delivery_semantics:
        at_most_once:
          description: "Fire-and-forget delivery"
          use_cases: ["status_updates", "heartbeats", "non_critical_notifications"]
          reliability: "low"
          performance: "high"
          
        at_least_once:
          description: "Guaranteed delivery with possible duplicates"
          use_cases: ["task_assignments", "data_requests", "coordination_messages"]
          reliability: "high"
          performance: "medium"
          duplicate_detection: true
          
        exactly_once:
          description: "Guaranteed single delivery"
          use_cases: ["financial_transactions", "compliance_reports", "critical_decisions"]
          reliability: "highest"
          performance: "lower"
          idempotency_required: true
          
      # Communication channels
      channels:
        direct_messaging:
          type: "point_to_point"
          reliability: "exactly_once"
          encryption: "required"
          audit_logging: true
          max_message_size: "1MB"
          retention: "24 hours"
          
        workflow_coordination:
          type: "multicast"
          reliability: "at_least_once"
          encryption: "required"
          audit_logging: true
          max_message_size: "10MB"
          retention: "7 days"
          
        status_broadcasts:
          type: "publish_subscribe"
          reliability: "at_most_once"
          encryption: "optional"
          audit_logging: false
          max_message_size: "64KB"
          retention: "1 hour"
          
        compliance_channel:
          type: "audit_trail"
          reliability: "exactly_once"
          encryption: "required"
          audit_logging: true
          max_message_size: "5MB"
          retention: "7 years"
          immutable: true

  # Message schemas and examples
  message_schemas.yaml: |
    # Agent Communication Message Schemas
    schemas:
      # Base message envelope
      message_envelope:
        type: "object"
        required: ["message_id", "message_type", "sender_id", "recipient_id", "timestamp", "protocol_version"]
        properties:
          message_id:
            type: "string"
            format: "uuid"
            description: "Unique message identifier"
            
          message_type:
            type: "string"
            enum: ["task_request", "task_response", "handoff", "coordination", "status_update", "error_notification"]
            description: "Type of message"
            
          sender_id:
            type: "string"
            pattern: "^(fi-|ra-|co-|cc-)[a-zA-Z0-9-]+$"
            description: "Sending agent identifier"
            
          recipient_id:
            type: "string"
            description: "Target agent identifier or 'broadcast'"
            
          timestamp:
            type: "string"
            format: "date-time"
            description: "Message creation timestamp (Australian timezone)"
            
          protocol_version:
            type: "string"
            pattern: "^\\d+\\.\\d+\\.\\d+$"
            description: "Protocol version"
            
          correlation_id:
            type: "string"
            format: "uuid"
            description: "Correlation ID for message chains"
            
          priority:
            type: "integer"
            minimum: 1
            maximum: 10
            default: 5
            description: "Message priority"
            
          expires_at:
            type: "string"
            format: "date-time"
            description: "Message expiration timestamp"
            
          retry_count:
            type: "integer"
            minimum: 0
            default: 0
            description: "Number of retry attempts"
            
          trace_id:
            type: "string"
            description: "Distributed tracing identifier"
            
          workflow_id:
            type: "string"
            format: "uuid"
            description: "Associated workflow identifier"

      # Task request message
      task_request_message:
        allOf:
          - $ref: "#/schemas/message_envelope"
          - type: "object"
            required: ["payload"]
            properties:
              message_type:
                const: "task_request"
              payload:
                type: "object"
                required: ["task_specification", "context"]
                properties:
                  task_specification:
                    type: "object"
                    required: ["task_type", "input_data", "expected_output"]
                    properties:
                      task_type:
                        type: "string"
                        description: "Type of task to perform"
                      input_data:
                        type: "object"
                        description: "Input data for task processing"
                      parameters:
                        type: "object"
                        description: "Task-specific parameters"
                      expected_output:
                        type: "object"
                        description: "Expected output format and structure"
                      timeout:
                        type: "integer"
                        description: "Task timeout in seconds"
                        
                  context:
                    type: "object"
                    properties:
                      workflow_context:
                        type: "object"
                        description: "Workflow-specific context"
                      agent_context:
                        type: "object"
                        description: "Agent-specific context"
                      business_context:
                        type: "object"
                        description: "Business domain context"
                        
                  compliance:
                    type: "object"
                    required: ["data_classification", "data_residency"]
                    properties:
                      data_classification:
                        type: "string"
                        enum: ["public", "internal", "restricted", "confidential"]
                        description: "Data classification level"
                      data_residency:
                        type: "string"
                        default: "australia"
                        description: "Required data residency"
                      audit_required:
                        type: "boolean"
                        default: true
                        description: "Whether audit logging is required"
                      retention_period:
                        type: "string"
                        description: "Data retention period"

      # Task response message
      task_response_message:
        allOf:
          - $ref: "#/schemas/message_envelope"
          - type: "object"
            required: ["payload"]
            properties:
              message_type:
                const: "task_response"
              payload:
                type: "object"
                required: ["status", "result"]
                properties:
                  status:
                    type: "string"
                    enum: ["success", "failure", "partial_success", "timeout", "cancelled"]
                    description: "Task execution status"
                    
                  result:
                    type: "object"
                    description: "Task execution result"
                    
                  error:
                    type: "object"
                    properties:
                      error_code:
                        type: "string"
                        description: "Error classification code"
                      error_message:
                        type: "string"
                        description: "Human-readable error message"
                      error_details:
                        type: "object"
                        description: "Detailed error information"
                      recoverable:
                        type: "boolean"
                        description: "Whether error is recoverable"
                        
                  execution_metadata:
                    type: "object"
                    properties:
                      start_time:
                        type: "string"
                        format: "date-time"
                        description: "Task start time"
                      end_time:
                        type: "string"
                        format: "date-time"
                        description: "Task completion time"
                      duration:
                        type: "number"
                        description: "Execution duration in seconds"
                      resource_usage:
                        type: "object"
                        description: "Resource utilization metrics"

      # Agent handoff message
      handoff_message:
        allOf:
          - $ref: "#/schemas/message_envelope"
          - type: "object"
            required: ["payload"]
            properties:
              message_type:
                const: "handoff"
              payload:
                type: "object"
                required: ["handoff_type", "target_agent", "handoff_data"]
                properties:
                  handoff_type:
                    type: "string"
                    enum: ["delegation", "escalation", "collaboration", "specialization"]
                    description: "Type of handoff being performed"
                    
                  target_agent:
                    type: "string"
                    description: "Target agent for handoff"
                    
                  handoff_reason:
                    type: "string"
                    description: "Reason for handoff"
                    
                  handoff_data:
                    type: "object"
                    required: ["current_state", "remaining_work"]
                    properties:
                      current_state:
                        type: "object"
                        description: "Current task/workflow state"
                      remaining_work:
                        type: "object"
                        description: "Work remaining to be done"
                      progress_summary:
                        type: "object"
                        description: "Summary of work completed"
                      context_transfer:
                        type: "object"
                        description: "Context needed by target agent"
                        
                  handoff_constraints:
                    type: "object"
                    properties:
                      deadline:
                        type: "string"
                        format: "date-time"
                        description: "Deadline for handoff completion"
                      quality_requirements:
                        type: "object"
                        description: "Quality standards for handoff"
                      compliance_requirements:
                        type: "object"
                        description: "Compliance requirements to maintain"

  # Australian compliance specifications
  compliance_specification.yaml: |
    # Australian Compliance for Agent Communication
    compliance:
      framework: "Australian Privacy Act 1988"
      data_residency: "australia"
      
      # Privacy protection requirements
      privacy_protection:
        data_minimization:
          enabled: true
          description: "Minimize data in agent communications"
          implementation: "Remove unnecessary fields from messages"
          
        consent_management:
          enabled: true
          description: "Ensure consent for data processing"
          implementation: "Include consent status in message metadata"
          
        purpose_limitation:
          enabled: true
          description: "Use data only for stated purposes"
          implementation: "Include purpose field in all messages"
          
        data_quality:
          enabled: true
          description: "Ensure data accuracy and completeness"
          implementation: "Validate message content before sending"
          
      # Audit and logging requirements
      audit_requirements:
        message_logging:
          enabled: true
          scope: "all_messages"
          retention: "7 years"
          storage_location: "australia"
          encryption: "required"
          
        access_logging:
          enabled: true
          scope: "all_access"
          retention: "2 years"
          real_time_monitoring: true
          
        compliance_reporting:
          enabled: true
          frequency: "quarterly"
          automated_generation: true
          regulatory_submission: false
          
      # Data security requirements
      security_requirements:
        encryption:
          in_transit: "TLS 1.3"
          at_rest: "AES-256"
          key_management: "australian_key_management_service"
          
        authentication:
          method: "mutual_tls"
          certificate_authority: "australian_ca"
          certificate_rotation: "90_days"
          
        authorization:
          model: "role_based_access_control"
          principle: "least_privilege"
          audit_trail: "complete"
          
        network_security:
          segmentation: "required"
          monitoring: "continuous"
          intrusion_detection: "enabled"
          
      # Data retention and disposal
      data_lifecycle:
        retention_periods:
          financial_data: "7 years"
          compliance_records: "7 years"
          audit_logs: "7 years"
          operational_data: "3 years"
          temporary_data: "24 hours"
          
        disposal_methods:
          secure_deletion: "cryptographic_erasure"
          physical_destruction: "australian_certified_facility"
          verification: "disposal_certificate_required"
          
        data_portability:
          export_format: "structured_json"
          encryption: "required"
          delivery_method: "secure_channel"

---
# Agent Communication Message Examples
apiVersion: v1
kind: ConfigMap
metadata:
  name: agent-communication-examples
  namespace: act-placemat
  labels:
    component: agents
    config-type: examples
    data-residency: australia
  annotations:
    description: "Example messages for agent communication protocol"
    compliance.framework: "australian-privacy-act"
data:
  # Financial analysis task request
  financial_analysis_request.json: |
    {
      "message_id": "550e8400-e29b-41d4-a716-446655440001",
      "message_type": "task_request",
      "sender_id": "cc-coordinator-001",
      "recipient_id": "fi-financial-001",
      "timestamp": "2024-01-15T10:30:00+11:00",
      "protocol_version": "1.0.0",
      "correlation_id": "550e8400-e29b-41d4-a716-446655440000",
      "priority": 8,
      "expires_at": "2024-01-15T12:30:00+11:00",
      "workflow_id": "wf-financial-assessment-001",
      "payload": {
        "task_specification": {
          "task_type": "financial_risk_assessment",
          "input_data": {
            "organization_id": "org_renewable_energy_coop_001",
            "financial_statements": {
              "balance_sheet": "s3://act-australia/financial/bs_2024_q1.pdf",
              "income_statement": "s3://act-australia/financial/is_2024_q1.pdf",
              "cash_flow": "s3://act-australia/financial/cf_2024_q1.pdf"
            },
            "assessment_period": "2024-q1",
            "regulatory_framework": "australian_cooperative_law"
          },
          "parameters": {
            "risk_categories": ["credit_risk", "operational_risk", "compliance_risk"],
            "assessment_depth": "comprehensive",
            "benchmark_against": "similar_australian_cooperatives",
            "include_recommendations": true
          },
          "expected_output": {
            "format": "structured_report",
            "sections": ["executive_summary", "risk_analysis", "recommendations", "compliance_status"],
            "delivery_format": "encrypted_pdf_and_json"
          },
          "timeout": 1800
        },
        "context": {
          "workflow_context": {
            "workflow_type": "community_project_assessment",
            "stakeholders": ["community_groups", "local_council", "state_regulators"],
            "decision_deadline": "2024-01-20T17:00:00+11:00"
          },
          "agent_context": {
            "previous_assessments": ["org_solar_farm_001", "org_wind_coop_002"],
            "expertise_required": ["australian_financial_regulations", "cooperative_governance"],
            "collaboration_agents": ["co-compliance-001"]
          },
          "business_context": {
            "industry": "renewable_energy",
            "geographic_scope": "victoria_australia",
            "regulatory_environment": "australian_energy_market",
            "community_impact": "high"
          }
        },
        "compliance": {
          "data_classification": "restricted",
          "data_residency": "australia",
          "audit_required": true,
          "retention_period": "7 years",
          "consent_status": "explicit_consent_obtained",
          "processing_purpose": "financial_risk_assessment_for_community_project"
        }
      }
    }

  # Research collaboration request
  research_collaboration_request.json: |
    {
      "message_id": "550e8400-e29b-41d4-a716-446655440002",
      "message_type": "coordination",
      "sender_id": "ra-research-001",
      "recipient_id": "ra-research-002",
      "timestamp": "2024-01-15T09:15:00+11:00",
      "protocol_version": "1.0.0",
      "correlation_id": "550e8400-e29b-41d4-a716-446655440003",
      "priority": 6,
      "expires_at": "2024-01-15T17:15:00+11:00",
      "workflow_id": "wf-policy-research-001",
      "payload": {
        "coordination_type": "collaborative_research",
        "collaboration_proposal": {
          "research_question": "Impact of Australian renewable energy policies on rural community economic development",
          "collaboration_scope": {
            "geographic_focus": "rural_victoria_and_nsw",
            "time_period": "2020-2024",
            "policy_frameworks": ["renewable_energy_target", "emissions_reduction_fund", "community_energy_grants"]
          },
          "division_of_work": {
            "primary_researcher": "ra-research-001",
            "secondary_researcher": "ra-research-002",
            "research_areas": {
              "ra-research-001": ["policy_analysis", "regulatory_framework", "government_programs"],
              "ra-research-002": ["economic_impact", "community_outcomes", "case_studies"]
            }
          },
          "collaboration_methodology": {
            "data_sharing_protocol": "structured_json_exchange",
            "quality_assurance": "peer_review_required",
            "synthesis_approach": "collaborative_analysis",
            "timeline": {
              "research_phase": "4 weeks",
              "analysis_phase": "2 weeks",
              "synthesis_phase": "1 week"
            }
          }
        },
        "deliverables": {
          "individual_reports": {
            "format": "structured_markdown",
            "deadline": "2024-02-10T17:00:00+11:00"
          },
          "collaborative_synthesis": {
            "format": "comprehensive_report",
            "deadline": "2024-02-17T17:00:00+11:00"
          },
          "policy_recommendations": {
            "format": "executive_briefing",
            "target_audience": "policy_makers"
          }
        },
        "compliance": {
          "data_classification": "internal",
          "data_residency": "australia",
          "audit_required": true,
          "retention_period": "3 years",
          "intellectual_property": "joint_ownership",
          "publication_rights": "shared_attribution"
        }
      }
    }

  # Agent handoff example
  agent_handoff_specialization.json: |
    {
      "message_id": "550e8400-e29b-41d4-a716-446655440004",
      "message_type": "handoff",
      "sender_id": "fi-financial-001",
      "recipient_id": "co-compliance-001",
      "timestamp": "2024-01-15T11:45:00+11:00",
      "protocol_version": "1.0.0",
      "correlation_id": "550e8400-e29b-41d4-a716-446655440000",
      "priority": 9,
      "workflow_id": "wf-financial-assessment-001",
      "payload": {
        "handoff_type": "specialization",
        "target_agent": "co-compliance-001",
        "handoff_reason": "Identified complex regulatory compliance issues requiring specialized expertise",
        "handoff_data": {
          "current_state": {
            "assessment_progress": "75_percent_complete",
            "completed_sections": ["financial_analysis", "risk_assessment", "operational_review"],
            "pending_sections": ["regulatory_compliance", "legal_framework_analysis"],
            "identified_issues": [
              {
                "issue_type": "regulatory_compliance",
                "description": "Potential conflicts with Australian Consumer Law provisions",
                "severity": "high",
                "requires_specialist": true
              },
              {
                "issue_type": "licensing_requirements",
                "description": "Unclear electricity retailer licensing obligations",
                "severity": "medium",
                "requires_specialist": true
              }
            ]
          },
          "remaining_work": {
            "compliance_assessment": {
              "scope": "full_regulatory_framework_review",
              "frameworks": ["australian_consumer_law", "national_electricity_rules", "victorian_energy_legislation"],
              "deliverables": ["compliance_report", "risk_mitigation_plan", "regulatory_recommendations"]
            },
            "legal_analysis": {
              "scope": "cooperative_structure_compliance",
              "areas": ["governance_requirements", "member_rights", "director_obligations"],
              "deliverables": ["legal_opinion", "governance_recommendations"]
            }
          },
          "progress_summary": {
            "financial_health": "strong_with_minor_concerns",
            "operational_capacity": "adequate_for_expansion",
            "risk_profile": "medium_risk_acceptable",
            "key_findings": [
              "Strong financial position with adequate reserves",
              "Effective operational management and community engagement",
              "Some regulatory compliance gaps requiring specialist attention"
            ]
          },
          "context_transfer": {
            "organization_profile": {
              "name": "Rural Victoria Renewable Energy Cooperative",
              "members": 1250,
              "assets": "AU$45M",
              "operations": ["solar_farms", "wind_generation", "battery_storage", "energy_retail"]
            },
            "stakeholder_map": {
              "internal": ["board_of_directors", "management_team", "member_representatives"],
              "external": ["local_councils", "state_regulators", "community_groups", "aemo"]
            },
            "regulatory_context": {
              "jurisdictions": ["commonwealth", "victoria"],
              "primary_regulators": ["accc", "aer", "essential_services_commission"],
              "recent_changes": ["distributed_energy_resources_rules", "consumer_data_right_energy"]
            }
          }
        },
        "handoff_constraints": {
          "deadline": "2024-01-20T17:00:00+11:00",
          "quality_requirements": {
            "compliance_assessment": "comprehensive_and_legally_defensible",
            "documentation": "regulatory_submission_ready",
            "recommendations": "actionable_and_prioritized"
          },
          "compliance_requirements": {
            "data_handling": "maintain_existing_classification_levels",
            "audit_trail": "preserve_complete_assessment_history",
            "stakeholder_communication": "coordinate_through_community_coordinator"
          },
          "coordination_requirements": {
            "status_updates": "daily_progress_reports",
            "escalation_path": "cc-coordinator-001",
            "final_integration": "joint_presentation_to_stakeholders"
          }
        }
      }
    }

  # Task response with results
  task_response_success.json: |
    {
      "message_id": "550e8400-e29b-41d4-a716-446655440005",
      "message_type": "task_response",
      "sender_id": "fi-financial-001",
      "recipient_id": "cc-coordinator-001",
      "timestamp": "2024-01-15T12:15:00+11:00",
      "protocol_version": "1.0.0",
      "correlation_id": "550e8400-e29b-41d4-a716-446655440000",
      "workflow_id": "wf-financial-assessment-001",
      "payload": {
        "status": "partial_success",
        "result": {
          "assessment_summary": {
            "overall_rating": "financially_sound_with_compliance_review_required",
            "financial_score": 8.2,
            "risk_level": "medium",
            "recommendation": "proceed_with_compliance_specialist_review"
          },
          "detailed_findings": {
            "financial_health": {
              "liquidity_ratio": 2.4,
              "debt_to_equity": 0.35,
              "revenue_growth": 0.18,
              "operating_margin": 0.12,
              "assessment": "strong_financial_position"
            },
            "operational_capacity": {
              "management_effectiveness": "high",
              "operational_efficiency": "good",
              "growth_capacity": "moderate",
              "technology_adoption": "advanced"
            },
            "risk_assessment": {
              "credit_risk": "low",
              "operational_risk": "medium",
              "regulatory_risk": "high",
              "market_risk": "medium"
            }
          },
          "compliance_flags": [
            {
              "area": "consumer_protection",
              "severity": "high",
              "description": "Potential gaps in consumer protection compliance",
              "requires_specialist": true
            },
            {
              "area": "licensing_obligations",
              "severity": "medium", 
              "description": "Electricity retailer licensing requirements unclear",
              "requires_specialist": true
            }
          ],
          "recommendations": [
            {
              "priority": "high",
              "category": "compliance",
              "action": "Engage compliance specialist for regulatory review",
              "timeline": "immediate"
            },
            {
              "priority": "medium",
              "category": "financial",
              "action": "Increase reserve fund to support expansion plans",
              "timeline": "3_months"
            }
          ],
          "handoff_required": {
            "target_agent": "co-compliance-001",
            "reason": "Specialized regulatory compliance expertise needed",
            "urgency": "high"
          }
        },
        "execution_metadata": {
          "start_time": "2024-01-15T10:30:00+11:00",
          "end_time": "2024-01-15T12:15:00+11:00",
          "duration": 6300,
          "resource_usage": {
            "cpu_time": 450,
            "memory_peak": "1.2GB",
            "storage_accessed": "150MB",
            "external_api_calls": 12
          },
          "data_sources": [
            "financial_statements_2024_q1",
            "industry_benchmarks_australia",
            "regulatory_database_updates",
            "market_analysis_reports"
          ],
          "quality_metrics": {
            "data_completeness": 0.95,
            "analysis_confidence": 0.88,
            "recommendation_strength": 0.82
          }
        },
        "compliance": {
          "data_classification": "restricted",
          "data_residency": "australia",
          "audit_trail": "complete",
          "retention_applied": "7_years",
          "access_log": "recorded",
          "encryption_status": "encrypted_at_rest_and_transit"
        }
      }
    }