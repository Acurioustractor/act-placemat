# Neo4j Configuration for ACT Life OS
# Optimized for community networks and Beautiful Obsolescence relationship tracking

#*****************************************************************
# Neo4j configuration
#*****************************************************************

# The name of the database to mount
dbms.default_database=lifeos

# Paths of directories in the installation.
dbms.directories.data=/data
dbms.directories.logs=/logs
dbms.directories.import=/var/lib/neo4j/import
dbms.directories.plugins=/plugins

# This setting constrains all `LOAD CSV` import files to be under the `import` directory. Remove or comment it out to allow files to be loaded from anywhere in the filesystem.
dbms.security.allow_csv_import_from_file_urls=true

# Whether requests to Neo4j are authenticated.
dbms.security.auth_enabled=true

# Require (or disable the requirement of) auth to access Neo4j
#dbms.security.auth_enabled=false

#*****************************************************************
# Network connector configuration
#*****************************************************************

# With default configuration Neo4j only accepts local connections.
# To accept non-local connections, uncomment this line:
dbms.connectors.default_listen_address=0.0.0.0

# You can also choose a specific network interface, and configure a non-default
# port for each connector, by setting their individual listen_address.

# The address at which this server can be reached by its clients. This may be the server's IP address or DNS name, or
# it may be the address of a reverse proxy which sits in front of the server. This setting may be overridden for
# specific connectors below.
dbms.connectors.default_advertised_address=lifeos-neo4j

# You can also choose a specific advertised hostname or IP address, and
# configure an advertised port for each connector, by setting their
# individual advertised_address.

# Bolt connector
dbms.connector.bolt.enabled=true
dbms.connector.bolt.tls_level=OPTIONAL
dbms.connector.bolt.listen_address=0.0.0.0:7687
dbms.connector.bolt.advertised_address=:7687

# HTTP Connector. There can be zero or one HTTP connectors.
dbms.connector.http.enabled=true
dbms.connector.http.listen_address=0.0.0.0:7474
dbms.connector.http.advertised_address=:7474

# HTTPS Connector. There can be zero or one HTTPS connectors.
dbms.connector.https.enabled=false
dbms.connector.https.listen_address=0.0.0.0:7473
dbms.connector.https.advertised_address=:7473

#*****************************************************************
# Performance settings
#*****************************************************************

# The amount of memory to use for mapping the store files, in bytes (or kilobytes with the 'k' suffix, megabytes with 'm' and gigabytes with 'g').
# This setting is advisory, it is a hint to the underlying operating system how much memory can be spared to map the mapped memory mapped files in use by the database.
# Larger databases generally benefit from a larger page cache along with a tuned page replacement algorithm.
# Increasing the size of the pagecache beyond the available free memory on the system may result in a decrease in performance.
dbms.memory.pagecache.size=2G

# Initial heap size (in MB)
dbms.memory.heap.initial_size=1g

# Maximum heap size (in MB)
dbms.memory.heap.max_size=4g

# The number of Cypher query execution plans that are cached.
dbms.query_cache_size=1000

#*****************************************************************
# Miscellaneous configuration
#*****************************************************************

# Enable this to be able to upgrade a store from an older version.
dbms.allow_upgrade=true

# Enable this to specify a parser other than the default one.
#cypher.default_language_version=3.5

# Determines if Cypher will allow using file URLs when loading data using
# `LOAD CSV`. Setting this value to `false` (default) will cause Neo4j to fail
# `LOAD CSV` clauses that load data from the file system.
dbms.security.allow_csv_import_from_file_urls=true

# Value of the Access-Control-Allow-Origin header sent over any HTTP or HTTPS
# connector. This defaults to '*', which allows broadest compatibility. Note
# that any URI provided here limits HTTP/HTTPS access to that URI only.
dbms.security.http_access_control_allow_origin=*

# Value of the Access-Control-Allow-Headers header sent over any HTTP or HTTPS
# connector. This defaults to '*', which allows broadest compatibility. Note
# that any headers provided here limits HTTP/HTTPS access to those headers only.
dbms.security.http_access_control_allow_headers=*

# Enable a remote shell server which Neo4j Shell clients can log in to.
dbms.shell.enabled=false

#*****************************************************************
# Logging configuration
#*****************************************************************

# To enable HTTP logging, uncomment this line
#dbms.logs.http.enabled=true

# Number of HTTP logs to keep.
dbms.logs.http.rotation.keep_number=5

# Size of each HTTP log that is kept.
#dbms.logs.http.rotation.size=20m

# To enable GC Logging, uncomment this line
dbms.logs.gc.enabled=true

# GC Logging Options
# see http://docs.oracle.com/javase/8/docs/technotes/tools/unix/java.html#BABHDABI for more information.
#dbms.logs.gc.options=-XX:+PrintGCDetails -XX:+PrintGCTimeStamps -XX:+PrintGCApplicationStoppedTime -XX:+PrintPromotionFailure -XX:+PrintTenuringDistribution

# Number of GC logs to keep.
dbms.logs.gc.rotation.keep_number=5

# Size of each GC log that is kept.
dbms.logs.gc.rotation.size=20m

# Size threshold for rotation of the debug log. If set to zero then no rotation will occur. Accepts a binary suffix "k", "m" or "g".
dbms.logs.debug.rotation.size=20m

# Maximum number of history files for the internal log.
dbms.logs.debug.rotation.keep_number=7

#*****************************************************************
# Beautiful Obsolescence & Community Control Settings
#*****************************************************************

# Enable query logging for community accountability
dbms.logs.query.enabled=true
dbms.logs.query.threshold=1000ms
dbms.logs.query.rotation.keep_number=7
dbms.logs.query.rotation.size=20m

# Enable transaction logging for transparency
dbms.transaction_timeout=60s
dbms.transaction.bookmark_ready_timeout=30s

# Security settings for community data sovereignty
dbms.security.auth_minimum_password_length=12
dbms.security.log_successful_authentication=true

# Australian timezone settings
dbms.db.timezone=Australia/Sydney

#*****************************************************************
# Plugins and Extensions
#*****************************************************************

# Enable APOC procedures for graph analytics
dbms.security.procedures.unrestricted=apoc.*,gds.*,n10s.*
dbms.security.procedures.allowlist=apoc.*,gds.*,n10s.*

# APOC configuration for Life OS
apoc.export.file.enabled=true
apoc.import.file.enabled=true
apoc.import.file.use_neo4j_config=true

# Graph Data Science library settings for community network analysis
gds.enterprise.license_file=

#*****************************************************************
# Transaction and consistency settings
#*****************************************************************

# The maximum time to wait for a running transaction to complete before forcibly terminating it.
dbms.transaction_timeout=60s

# The maximum number of concurrently running transactions.
dbms.transaction.concurrent.maximum=1000

# Controls the consistency requirements that the database has to fulfill when committing a transaction.
# The default is to call fsync on the transaction logs when they are rotated to make sure that transactions are durable.
dbms.tx_log.rotation.retention_policy=100M size

#*****************************************************************
# Memory settings optimized for community network analysis
#*****************************************************************

# Configure the operating system level read/write caching that is enabled by default for all files.
dbms.memory.off_heap.max_size=2g

# The size of the off-heap block cache used by the record storage engine for caching.
dbms.memory.off_heap.block_cache_size=2g

#*****************************************************************
# Community network performance optimization
#*****************************************************************

# Number of relationship types to cache in the relationship type token cache
internal.dbms.index_sampling.sample_size_limit=1000000

# Number of label ids to cache in the label token cache
internal.dbms.label_cache_size=100000

# Number of relationship type ids to cache in the relationship type token cache  
internal.dbms.relationship_type_cache_size=100000