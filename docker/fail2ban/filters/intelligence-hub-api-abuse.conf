# Fail2ban filter for Intelligence Hub API abuse
# Australian-compliant rate limiting and abuse detection

[Definition]
# Detect excessive API requests to Intelligence Hub endpoints
failregex = ^<HOST> .* "(?:GET|POST|PUT|DELETE) /api/.*" (429|400|401|403) .*$
            ^<HOST> .* "(?:GET|POST|PUT|DELETE) /api/tasks.*" 200 .* \d{4,}$
            ^<HOST> .* ".*" .* .* ".*bot.*" .*$
            ^<HOST> .* ".*" .* .* ".*crawler.*" .*$
            ^<HOST> .* ".*" .* .* ".*scanner.*" .*$

# Ignore legitimate requests
ignoreregex = ^<HOST> .* "GET /api/health" 200 .*$
              ^<HOST> .* "GET /health" 200 .*$
              ^<HOST> .* ".*" .* .* "ACT-Placemat-Agent.*" .*$

[INCLUDES]
before = common.conf

[Definition]
# Date format for Australian timezone
datepattern = %%d/%%b/%%Y:%%H:%%M:%%S %%z