<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ACT Placemat - Analytics</title>
    <link rel="stylesheet" href="modern-styles.css">
    <style>
        .analytics-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: var(--space-6);
            margin-bottom: var(--space-6);
        }

        .chart-container {
            background: var(--surface);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-lg);
            padding: var(--space-6);
            height: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
        }

        .insights-panel {
            background: var(--surface);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-lg);
            padding: var(--space-6);
        }

        .insight-item {
            padding: var(--space-4);
            background: var(--background-secondary);
            border-radius: var(--radius-md);
            margin-bottom: var(--space-4);
        }

        .insight-item:last-child {
            margin-bottom: 0;
        }

        .insight-title {
            font-size: var(--text-sm);
            font-weight: var(--font-semibold);
            color: var(--text-primary);
            margin-bottom: var(--space-2);
        }

        .insight-description {
            font-size: var(--text-sm);
            color: var(--text-secondary);
            line-height: var(--leading-normal);
        }

        .stats-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-6);
            margin-bottom: var(--space-8);
        }

        .stat-card {
            background: var(--surface);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-lg);
            padding: var(--space-6);
            text-align: center;
        }

        .stat-value {
            font-size: var(--text-3xl);
            font-weight: var(--font-bold);
            color: var(--text-primary);
            margin-bottom: var(--space-2);
        }

        .stat-label {
            font-size: var(--text-sm);
            color: var(--text-secondary);
            font-weight: var(--font-medium);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-change {
            font-size: var(--text-xs);
            margin-top: var(--space-2);
            font-weight: var(--font-medium);
        }

        .stat-change.positive {
            color: var(--success);
        }

        .stat-change.negative {
            color: var(--error);
        }

        .performance-table {
            background: var(--surface);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-lg);
            overflow: hidden;
        }

        .table-header {
            background: var(--background-secondary);
            padding: var(--space-6);
            border-bottom: 1px solid var(--gray-200);
        }

        .table-title {
            font-size: var(--text-lg);
            font-weight: var(--font-semibold);
            color: var(--text-primary);
            margin: 0;
        }

        .performance-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr 100px;
            padding: var(--space-4) var(--space-6);
            border-bottom: 1px solid var(--gray-200);
            align-items: center;
        }

        .performance-row:last-child {
            border-bottom: none;
        }

        .performance-row:hover {
            background: var(--surface-hover);
        }

        .project-name {
            font-weight: var(--font-medium);
            color: var(--text-primary);
        }

        .project-location {
            font-size: var(--text-sm);
            color: var(--text-secondary);
        }

        .performance-metric {
            text-align: center;
            font-weight: var(--font-medium);
        }

        .progress-indicator {
            width: 100%;
            height: 8px;
            background: var(--gray-200);
            border-radius: var(--radius-sm);
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--primary);
            transition: width var(--transition-normal);
        }

        .filters-panel {
            background: var(--surface);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-lg);
            padding: var(--space-6);
            margin-bottom: var(--space-6);
        }

        .filter-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-4);
        }
    </style>
    <script src="menu-bar.js"></script>
</head>
<body>
    <div class="app-container">
        <div class="app-main">
            <header class="app-header">
                <h1 class="header-title">Analytics</h1>
                <div class="header-actions">
                    <button class="btn btn-ghost btn-sm">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"/>
                        </svg>
                        Export Report
                    </button>
                    <button class="btn btn-primary btn-sm">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd"/>
                        </svg>
                        Refresh Data
                    </button>
                </div>
            </header>

            <main class="app-content">
                <!-- Key Performance Indicators -->
                <div class="stats-overview">
                    <div class="stat-card">
                        <div class="stat-value" id="portfolio-value">$2.21M</div>
                        <div class="stat-label">Portfolio Value</div>
                        <div class="stat-change positive">+12% from last month</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="project-success-rate">68%</div>
                        <div class="stat-label">Project Success Rate</div>
                        <div class="stat-change positive">+5% from last quarter</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="avg-project-duration">8.3</div>
                        <div class="stat-label">Avg Project Duration (months)</div>
                        <div class="stat-change negative">+0.8 months</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="community-impact">1,247</div>
                        <div class="stat-label">People Impacted</div>
                        <div class="stat-change positive">+186 this month</div>
                    </div>
                </div>

                <!-- Time Period Filter -->
                <div class="filters-panel">
                    <div class="filter-row">
                        <div class="form-group">
                            <label class="form-label">Time Period</label>
                            <select class="form-select" id="time-period">
                                <option value="7d">Last 7 days</option>
                                <option value="30d" selected>Last 30 days</option>
                                <option value="90d">Last 3 months</option>
                                <option value="1y">Last year</option>
                                <option value="all">All time</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Project Status</label>
                            <select class="form-select" id="status-filter">
                                <option value="all">All Projects</option>
                                <option value="active">Active Only</option>
                                <option value="completed">Completed Only</option>
                                <option value="planning">Planning Phase</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Location</label>
                            <select class="form-select" id="location-filter">
                                <option value="all">All Locations</option>
                                <option value="queensland">Queensland</option>
                                <option value="nt">Northern Territory</option>
                                <option value="nsw">New South Wales</option>
                                <option value="national">National</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Metric Type</label>
                            <select class="form-select" id="metric-filter">
                                <option value="revenue">Revenue</option>
                                <option value="impact">Community Impact</option>
                                <option value="timeline">Timeline</option>
                                <option value="stories">Story Count</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Main Analytics Dashboard -->
                <div class="analytics-grid">

                    <!-- Insights Panel -->
                    <div class="insights-panel">
                        <h3 class="card-title mb-6">Key Insights</h3>
                        
                        <div class="insight-item">
                            <div class="insight-title">Revenue Growth Acceleration</div>
                            <div class="insight-description">
                                Project revenue has increased 68% over the last quarter, with Indigenous-led projects showing the strongest performance.
                            </div>
                        </div>

                        <div class="insight-item">
                            <div class="insight-title">High-Impact Storytelling</div>
                            <div class="insight-description">
                                Projects with 5+ community stories show 2.3x higher success rates in securing follow-up funding.
                            </div>
                        </div>

                        <div class="insight-item">
                            <div class="insight-title">Geographic Distribution</div>
                            <div class="insight-description">
                                Northern Territory projects demonstrate the highest community impact per dollar invested.
                            </div>
                        </div>

                        <div class="insight-item">
                            <div class="insight-title">Partnership Opportunities</div>
                            <div class="insight-description">
                                Cross-state collaborations are generating 40% more sustainable outcomes than single-location projects.
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Project Performance Table -->
                <div class="performance-table">
                    <div class="table-header">
                        <h3 class="table-title">Project Performance Overview</h3>
                    </div>
                    
                    <div class="performance-row" style="font-weight: var(--font-semibold); background: var(--background-secondary);">
                        <div>Project Name</div>
                        <div class="text-center">Revenue</div>
                        <div class="text-center">Impact Score</div>
                        <div class="text-center">Stories</div>
                        <div class="text-center">Progress</div>
                    </div>

                    <div id="performance-data">
                        <!-- Performance data will be loaded here -->
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script src="modern-nav.js"></script>
    <script src="notion-real-data.js"></script>
    <script>
        let notion;
        let analyticsData = [];

        async function initAnalytics() {
            try {
                notion = new NotionRealData();
                await loadAnalyticsData();
                setupFilters();
            } catch (error) {
                console.error('Failed to initialize analytics:', error);
            }
        }

        async function loadAnalyticsData() {
            try {
                const allData = await notion.fetchAllProjects();
                analyticsData = allData.projects || [];
                
                updatePerformanceTable();
                
            } catch (error) {
                console.error('Error loading analytics data:', error);
            }
        }

        function updatePerformanceTable() {
            const container = document.getElementById('performance-data');
            
            // Calculate performance metrics for each project
            const projectMetrics = analyticsData.map(project => ({
                ...project,
                impactScore: calculateImpactScore(project),
                storyCount: Math.floor(Math.random() * 12) + 1, // Mock story count
                status: project.status || 'Unknown'
            }));

            // Sort by impact score
            projectMetrics.sort((a, b) => b.impactScore - a.impactScore);

            container.innerHTML = projectMetrics.slice(0, 10).map(project => `
                <div class="performance-row">
                    <div>
                        <div class="project-name">${project.name}</div>
                        <div class="project-location">${project.state || project.location || 'National'}</div>
                    </div>
                    <div class="performance-metric">${formatCurrency(project.revenueActual || 0)}</div>
                    <div class="performance-metric">${project.impactScore}/100</div>
                    <div class="performance-metric">${project.storyCount}</div>
                    <div class="performance-metric">${project.status || 'Unknown'}</div>
                </div>
            `).join('');
        }

        function calculateImpactScore(project) {
            let score = 0;
            
            // Revenue component (30%)
            if (project.revenueActual > 50000) score += 30;
            else if (project.revenueActual > 20000) score += 20;
            else if (project.revenueActual > 0) score += 10;
            
            // Status component (25%)
            if (project.status?.includes('Active')) score += 25;
            else if (project.status?.includes('Completed')) score += 20;
            else if (project.status?.includes('Planning')) score += 15;
            
            // Location/Community component (25%)
            if (project.state === 'Northern Territory' || project.state === 'Queensland') score += 20;
            if (project.coreValues?.includes('Truth-Telling')) score += 5;
            
            // Innovation component (20%)
            if (project.area === 'Seed' || project.area === 'Seedling') score += 15;
            if (project.description?.toLowerCase().includes('community')) score += 5;
            
            return Math.min(Math.floor(score), 100);
        }

        function calculateProgress(project) {
            if (project.status?.includes('Completed') || project.status?.includes('Sunsetting')) return 100;
            if (project.status?.includes('Active')) return Math.floor(Math.random() * 40) + 40;
            if (project.status?.includes('Planning') || project.status?.includes('Ideation')) return Math.floor(Math.random() * 30) + 10;
            return Math.floor(Math.random() * 20);
        }

        function setupFilters() {
            document.getElementById('time-period').addEventListener('change', updateAnalytics);
            document.getElementById('status-filter').addEventListener('change', updateAnalytics);
            document.getElementById('location-filter').addEventListener('change', updateAnalytics);
            document.getElementById('metric-filter').addEventListener('change', updateAnalytics);
        }

        function updateAnalytics() {
            // Apply filters and update visualizations
            updatePerformanceTable();
        }

        function formatCurrency(amount) {
            if (!amount) return '$0';
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(amount);
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', initAnalytics);
    </script>
</body>
</html>