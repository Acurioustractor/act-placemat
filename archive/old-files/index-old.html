<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A Curious Tractor - Project Overview</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background: #f5f5f5;
            color: #333;
            line-height: 1.4;
        }
        
        .header {
            background: #333;
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 1.8em;
            margin-bottom: 5px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .main-areas {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .area-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .area-card:hover {
            border-color: #2196F3;
            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.15);
            transform: translateY(-2px);
        }
        
        .area-card.active {
            border-color: #2196F3;
            background: #f8fbff;
        }
        
        .area-card .area-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
        }
        
        .area-card .area-subtitle {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 12px;
            line-height: 1.4;
        }
        
        .area-card .area-count {
            color: #2196F3;
            font-weight: bold;
            font-size: 0.9em;
        }
        
        .filters {
            background: white;
            padding: 15px;
            margin-bottom: 20px;
            border: 1px solid #ddd;
        }
        
        .filter-group {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .refresh-btn {
            background: #2196F3;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background 0.3s ease;
        }
        
        .refresh-btn:hover {
            background: #1976D2;
        }
        
        .refresh-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .filter-group label {
            font-weight: bold;
        }
        
        select {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .project-count {
            margin-left: auto;
            font-weight: bold;
            color: #666;
        }
        
        .area-section {
            background: white;
            border: 1px solid #ddd;
            margin-bottom: 10px;
            border-radius: 4px;
        }
        
        .area-header {
            background: #f8f8f8;
            padding: 15px;
            cursor: pointer;
            border-bottom: 1px solid #ddd;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.2s;
        }
        
        .area-header:hover {
            background: #f0f0f0;
        }
        
        .area-header.active {
            background: #e8f4f8;
        }
        
        .area-title {
            font-weight: bold;
            font-size: 1.1em;
        }
        
        .area-meta {
            display: flex;
            gap: 15px;
            align-items: center;
            color: #666;
            font-size: 0.9em;
        }
        
        .expand-arrow {
            transition: transform 0.2s;
        }
        
        .expand-arrow.rotated {
            transform: rotate(90deg);
        }
        
        .area-content {
            display: none;
            padding: 0;
        }
        
        .area-content.show {
            display: block;
        }
        
        .project-item {
            border-bottom: 1px solid #eee;
            padding: 15px;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .project-item:hover {
            background: #f9f9f9;
        }
        
        .project-item:last-child {
            border-bottom: none;
        }
        
        .project-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }
        
        .project-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }
        
        .project-badges {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: bold;
        }
        
        .status-active {
            background: #ffebee;
            color: #c62828;
        }
        
        .status-building {
            background: #f3e5f5;
            color: #7b1fa2;
        }
        
        .status-harvest {
            background: #fff3e0;
            color: #ef6c00;
        }
        
        .status-ideation {
            background: #fce4ec;
            color: #ad1457;
        }
        
        .status-sunsetting {
            background: #efebe9;
            color: #5d4037;
        }
        
        .status-unknown {
            background: #f5f5f5;
            color: #757575;
        }
        
        .funding {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: bold;
        }
        
        .funding-funded {
            background: #e8f5e8;
            color: #2e7d32;
        }
        
        .funding-needs {
            background: #fff3e0;
            color: #ef6c00;
        }
        
        .funding-self {
            background: #e3f2fd;
            color: #1565c0;
        }
        
        .funding-community {
            background: #f3e5f5;
            color: #7b1fa2;
        }
        
        .project-meta {
            margin-bottom: 15px;
        }
        
        .meta-section {
            margin-bottom: 8px;
            color: #666;
        }
        
        .practices-section,
        .tests-section,
        .stories-section {
            margin-bottom: 15px;
        }
        
        .practices-section h4,
        .tests-section h4,
        .stories-section h4 {
            color: #333;
            margin-bottom: 8px;
            font-size: 0.95em;
        }
        
        .practices-list,
        .tests-list {
            margin: 0;
            padding-left: 20px;
        }
        
        .practices-list li,
        .tests-list li {
            margin-bottom: 4px;
            color: #666;
            font-size: 0.9em;
        }
        
        .stories-note {
            color: #666;
            font-size: 0.9em;
            font-style: italic;
        }
        
        .project-description {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 10px;
            line-height: 1.4;
        }
        
        .project-details {
            display: none;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #eee;
            background: #fafafa;
            margin: 15px -15px -15px -15px;
            padding: 15px;
        }
        
        .project-details.show {
            display: block;
        }
        
        .tags {
            display: flex;
            gap: 4px;
            flex-wrap: wrap;
            margin-top: 10px;
        }
        
        .tag {
            background: #f0f0f0;
            color: #666;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.75em;
        }
        
        .flow-connector {
            width: 2px;
            height: 20px;
            background: #ddd;
            margin: 0 auto;
        }
        
        .hidden {
            display: none;
        }
        
        .area-projects {
            margin-top: 30px;
        }
        
        .area-projects h2 {
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #2196F3;
        }
        
        .projects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
        }
        
        .no-projects {
            text-align: center;
            padding: 40px;
            color: #666;
            font-style: italic;
        }
        
        @media (max-width: 768px) {
            .main-areas {
                grid-template-columns: 1fr;
            }
            
            .projects-grid {
                grid-template-columns: 1fr;
            }
            
            .filter-group {
                flex-direction: column;
                align-items: stretch;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>A Curious Tractor - Project Overview</h1>
    </div>
    
    <div class="container">
        <div class="main-areas">
            <div class="area-card" onclick="toggleMainArea('story-sovereignty')">
                <div class="area-title">Story & Sovereignty</div>
                <div class="area-subtitle">Community-controlled narratives and data ownership</div>
                <div class="area-count" id="story-sovereignty-count">0 projects</div>
            </div>
            
            <div class="area-card" onclick="toggleMainArea('economic-freedom')">
                <div class="area-title">Economic Freedom</div>
                <div class="area-subtitle">Community ownership and cooperative economics</div>
                <div class="area-count" id="economic-freedom-count">0 projects</div>
            </div>
            
            <div class="area-card" onclick="toggleMainArea('community-engagement')">
                <div class="area-title">Community Engagement</div>
                <div class="area-subtitle">Participatory democracy and mutual aid</div>
                <div class="area-count" id="community-engagement-count">0 projects</div>
            </div>
            
            <div class="area-card" onclick="toggleMainArea('operations-infrastructure')">
                <div class="area-title">Operations & Infrastructure</div>
                <div class="area-subtitle">Systems and tools for community resilience</div>
                <div class="area-count" id="operations-infrastructure-count">0 projects</div>
            </div>
            
            <div class="area-card" onclick="toggleMainArea('research-development')">
                <div class="area-title">Research & Development</div>
                <div class="area-subtitle">Community-led innovation and experimentation</div>
                <div class="area-count" id="research-development-count">0 projects</div>
            </div>
        </div>
        
        <div class="filters">
            <div class="filter-group">
                <label for="statusFilter">Status:</label>
                <select id="statusFilter" onchange="filterProjects()">
                    <option value="all">All Status</option>
                    <option value="Active">Active</option>
                    <option value="Building">Building</option>
                    <option value="Harvest">Harvest</option>
                </select>
                
                <label for="fundingFilter">Funding:</label>
                <select id="fundingFilter" onchange="filterProjects()">
                    <option value="all">All Funding</option>
                    <option value="Funded">Funded</option>
                    <option value="Needs Funding">Needs Funding</option>
                    <option value="Self Funded">Self Funded</option>
                    <option value="Community Owned">Community Owned</option>
                </select>
                
                <button id="refresh-btn" onclick="refreshFromNotion()" class="refresh-btn">Refresh from Notion</button>
                
                <div class="project-count" id="projectCount">Loading projects...</div>
            </div>
        </div>
        
        <div id="projectsContainer">
            <!-- Projects will be populated by JavaScript -->
        </div>
    </div>
    
    <script src="notion-mcp.js"></script>
    <script>
        // Notion Configuration - Using your actual credentials
        const notionConfig = {
            token: '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',
            databaseId: '177ebcf981cf80dd9514f1ec32f3314c'
        };
        
        // Initialize Notion integration with browser-compatible config
        let notionIntegration;
        try {
            // For browser environment, pass config directly
            notionIntegration = new PlacematNotionIntegration(notionConfig);
        } catch (error) {
            console.log('Notion MCP initialization failed, using fallback:', error);
            // Create a simple fallback object
            notionIntegration = {
                getProjects: async () => projects,
                refreshProjects: async () => projects,
                setupAutoRefresh: () => null
            };
        }

        // Project data (fallback)
        const projects = [
            {
                name: "Empathy Ledger",
                area: "Story & Sovereignty",
                description: "Platform ensuring storytellers retain control and share in value created from their narratives.",
                status: "Active",
                funding: "Funded",
                tags: ["Truth-Telling", "Community Ownership"],
                lead: "Nicholas Herriman (ACT)",
                themes: ["Storytelling"],
                aiSummary: "Platform ensuring storytellers retain control and share in value created from their narratives, dismantling extractive storytelling practices."
            }
        ];

        // Global state
        let allProjects = [];
        let filteredProjects = [];
        let activeArea = null;

        // Area mapping for cleaner URLs and IDs
        const areaMapping = {
            'Story & Sovereignty': 'story-sovereignty',
            'Economic Freedom': 'economic-freedom', 
            'Community Engagement': 'community-engagement',
            'Operations & Infrastructure': 'operations-infrastructure',
            'Research & Development': 'research-development'
        };

        // Load real projects from Notion on page load
        async function loadNotionProjects() {
            try {
                console.log('Loading projects from Notion...');
                const notionProjects = await notionIntegration.getProjects();
                console.log('Loaded projects:', notionProjects);
                
                if (notionProjects && notionProjects.length > 0) {
                    allProjects = notionProjects;
                    filteredProjects = [...allProjects];
                    updateAreaCounts();
                    console.log(`Successfully loaded ${allProjects.length} projects from Notion`);
                } else {
                    console.log('No projects loaded from Notion, using fallback data');
                    allProjects = projects;
                    filteredProjects = [...allProjects];
                    updateAreaCounts();
                }
            } catch (error) {
                console.error('Error loading Notion projects:', error);
                allProjects = projects;
                filteredProjects = [...allProjects];
                updateAreaCounts();
            }
        }

        function groupProjectsByArea(projectsToShow = allProjects) {
            const grouped = {};
            projectsToShow.forEach(project => {
                if (!grouped[project.area]) {
                    grouped[project.area] = [];
                }
                grouped[project.area].push(project);
            });
            return grouped;
        }
        
        function updateAreaCounts() {
            const groupedProjects = groupProjectsByArea(filteredProjects);
            
            // Update each area count
            Object.keys(areaMapping).forEach(areaName => {
                const areaId = areaMapping[areaName];
                const count = groupedProjects[areaName] ? groupedProjects[areaName].length : 0;
                const countElement = document.getElementById(`${areaId}-count`);
                if (countElement) {
                    countElement.textContent = `${count} projects`;
                }
            });
            
            // Update total count
            const totalCountElement = document.getElementById('projectCount');
            if (totalCountElement) {
                totalCountElement.textContent = `${filteredProjects.length} total projects`;
            }
        }
        
        function toggleMainArea(areaId) {
            // Clear previous active states
            document.querySelectorAll('.area-card').forEach(card => {
                card.classList.remove('active');
            });
            
            // If clicking the same area, close it
            if (activeArea === areaId) {
                activeArea = null;
                document.getElementById('projectsContainer').innerHTML = '';
                return;
            }
            
            // Set new active area
            activeArea = areaId;
            const clickedCard = event.currentTarget;
            clickedCard.classList.add('active');
            
            // Find the area name from the mapping
            const areaName = Object.keys(areaMapping).find(key => areaMapping[key] === areaId);
            
            // Render projects for this area
            renderProjectsForArea(areaName);
        }

        function createProjectHTML(project) {
            const statusClass = `status-${project.status?.toLowerCase().replace(/[^a-z]/g, '') || 'unknown'}`;
            const fundingClass = `funding-${project.funding?.toLowerCase().replace(/[^a-z]/g, '') || 'unknown'}`;
            
            // Format financial data
            const formatCurrency = (amount) => {
                if (!amount || amount === 0) return '';
                return `$${amount.toLocaleString()}`;
            };

            const revenueInfo = [];
            if (project.revenueActual > 0) revenueInfo.push(`Revenue: ${formatCurrency(project.revenueActual)}`);
            if (project.revenuePotential > 0) revenueInfo.push(`Potential: ${formatCurrency(project.revenuePotential)}`);
            if (project.actualIncoming > 0) revenueInfo.push(`Incoming: ${formatCurrency(project.actualIncoming)}`);

            return `
                <div class="project-item" onclick="toggleProjectDetails('${project.id}')">
                    <div class="project-header">
                        <div>
                            <div class="project-title">${project.name}</div>
                            ${project.location ? `<div class="meta-section"><strong>Location:</strong> ${project.location}</div>` : ''}
                            ${project.lead ? `<div class="meta-section"><strong>Lead:</strong> ${project.lead}</div>` : ''}
                        </div>
                        <div class="project-badges">
                            ${project.status ? `<span class="status ${statusClass}">${project.status}</span>` : ''}
                            ${project.funding ? `<span class="funding ${fundingClass}">${project.funding}</span>` : ''}
                        </div>
                    </div>
                    
                    ${project.aiSummary ? `<div class="project-description">${project.aiSummary}</div>` : ''}
                    ${project.description ? `<div class="project-description">${project.description}</div>` : ''}
                    
                    ${revenueInfo.length > 0 ? `<div class="meta-section"><strong>Financial:</strong> ${revenueInfo.join(' | ')}</div>` : ''}
                    ${project.nextMilestone ? `<div class="meta-section"><strong>Next Milestone:</strong> ${new Date(project.nextMilestone).toLocaleDateString()}</div>` : ''}
                    
                    <div class="tags">
                        ${project.themes ? project.themes.map(theme => `<span class="tag">${theme}</span>`).join('') : ''}
                        ${project.tags ? project.tags.map(tag => `<span class="tag">${tag}</span>`).join('') : ''}
                        ${project.coreValues ? `<span class="tag" style="background: #e3f2fd;">${project.coreValues}</span>` : ''}
                    </div>
                    
                    <div class="project-details" id="details-${project.id}">
                        ${project.place ? `<div class="meta-section"><strong>Stage:</strong> ${project.place}</div>` : ''}
                        ${project.state ? `<div class="meta-section"><strong>State:</strong> ${project.state}</div>` : ''}
                        ${project.url ? `<div class="meta-section"><strong>Notion:</strong> <a href="${project.url}" target="_blank">View in Notion</a></div>` : ''}
                        <div class="meta-section"><strong>Last Updated:</strong> ${new Date(project.lastModified).toLocaleDateString()}</div>
                    </div>
                </div>
            `;
        }

        function toggleProjectDetails(projectId) {
            const details = document.getElementById(`details-${projectId}`);
            if (details) {
                details.classList.toggle('show');
            }
        }

        function renderProjectsForArea(areaName) {
            const container = document.getElementById('projectsContainer');
            const areaProjects = filteredProjects.filter(project => project.area === areaName);
            
            if (areaProjects.length === 0) {
                container.innerHTML = `
                    <div class="no-projects">
                        <p>No projects found in ${areaName} with current filters.</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = `
                <div class="area-projects">
                    <h2>${areaName} Projects (${areaProjects.length})</h2>
                    <div class="projects-grid">
                        ${areaProjects.map(project => createProjectHTML(project)).join('')}
                    </div>
                </div>
            `;
        }

        // Refresh function for the refresh button
        async function refreshFromNotion() {
            const refreshBtn = document.getElementById('refresh-btn');
            refreshBtn.disabled = true;
            refreshBtn.textContent = 'Refreshing...';
            
            try {
                await loadNotionProjects();
                refreshBtn.textContent = 'Refreshed!';
                setTimeout(() => {
                    refreshBtn.textContent = 'Refresh from Notion';
                    refreshBtn.disabled = false;
                }, 2000);
            } catch (error) {
                console.error('Refresh failed:', error);
                refreshBtn.textContent = 'Refresh Failed';
                setTimeout(() => {
                    refreshBtn.textContent = 'Refresh from Notion';
                    refreshBtn.disabled = false;
                }, 2000);
            }
        }

        // Filter projects based on status and funding
        function filterProjects() {
            const statusFilter = document.getElementById('statusFilter').value;
            const fundingFilter = document.getElementById('fundingFilter').value;
            
            filteredProjects = allProjects.filter(project => {
                const statusMatch = statusFilter === 'all' || project.status === statusFilter;
                const fundingMatch = fundingFilter === 'all' || project.funding === fundingFilter;
                return statusMatch && fundingMatch;
            });
            
            updateAreaCounts();
            
            // If an area is currently active, refresh its display
            if (activeArea) {
                const areaName = Object.keys(areaMapping).find(key => areaMapping[key] === activeArea);
                if (areaName) {
                    renderProjectsForArea(areaName);
                }
            }
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            loadNotionProjects();
        });
    </script>
</body>
</html>
        // Notion Configuration - Using your actual credentials
        const notionConfig = {
            token: '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',
            databaseId: '177ebcf981cf80dd9514f1ec32f3314c'
        };
        
        // Initialize Notion integration with browser-compatible config
        let notionIntegration;
        try {
            // For browser environment, pass config directly
            notionIntegration = new PlacematNotionIntegration(notionConfig);
        } catch (error) {
            console.log('Notion MCP initialization failed, using fallback:', error);
            // Create a simple fallback object
            notionIntegration = {
                getProjects: async () => projects,
                refreshProjects: async () => projects,
                setupAutoRefresh: () => null
            };
        }

        // Load real projects from Notion on page load
        async function loadNotionProjects() {
            try {
                console.log('Loading projects from Notion...');
                const notionProjects = await notionIntegration.getProjects();
                console.log('Loaded projects:', notionProjects);
                
                if (notionProjects && notionProjects.length > 0) {
                    allProjects = notionProjects;
                    filteredProjects = [...allProjects];
                    updateAreaCounts();
                    console.log(`Successfully loaded ${allProjects.length} projects from Notion`);
                } else {
                    console.log('No projects loaded from Notion, using fallback data');
                    allProjects = projects;
                    filteredProjects = [...allProjects];
                    updateAreaCounts();
                }
            } catch (error) {
                console.error('Error loading Notion projects:', error);
                allProjects = projects;
                filteredProjects = [...allProjects];
                updateAreaCounts();
            }
        }
        
        // Project data (fallback)
        const projects = [
            {
                name: "Empathy Ledger",
                area: "Story & Sovereignty",
                description: "Platform ensuring storytellers retain control and share in value created from their narratives, dismantling extractive storytelling practices.",
                status: "Active",
                funding: "Funded",
                tags: ["Truth-Telling", "Community Ownership"],
                lead: "Nicholas Herriman (ACT)",
                beneficiaries: "Storytellers, communities sharing narratives",
                practices: ["Community-controlled storytelling", "Value-sharing protocols", "Consent management systems"],
                tests: ["Story ownership verification", "Value distribution tracking", "Community consent protocols"],
                stories: "Storyteller empowerment testimonials available"
            },
            {
                name: "Wilya Janta Communications",
                area: "Story & Sovereignty",
                description: "Supporting the Frank family to capture and share traditional stories under their complete control and cultural protocols.",
                status: "Active",
                funding: "Funded",
                tags: ["Truth-Telling", "Economic Freedom", "Indigenous"],
                lead: "Frank Family (Traditional Owners)",
                beneficiaries: "Indigenous community, cultural preservation",
                practices: ["Cultural protocol adherence", "Family-controlled narrative", "Traditional knowledge protection"],
                tests: ["Cultural protocol effectiveness", "Community engagement measurement", "Story preservation quality"],
                stories: "Traditional knowledge keeper stories available"
            },
            {
                name: "ANAT SPECTRA 2025",
                area: "Story & Sovereignty",
                description: "Nicholas leads storytelling project featuring Gold Phone installation for interactive conversations at USC Art Gallery.",
                status: "Active",
                funding: "Funded",
                tags: ["Storytelling", "Truth-Telling"],
                lead: "Nicholas Herriman (ACT)",
                beneficiaries: "Gallery visitors, conversation participants",
                practices: ["Interactive storytelling", "Public conversation facilitation", "Art-based narrative sharing"],
                tests: ["Visitor engagement tracking", "Conversation quality assessment", "Story collection protocols"],
                stories: "Gallery conversation stories available"
            },
            {
                name: "Barkly Backbone",
                area: "Story & Sovereignty",
                description: "Building storytelling infrastructure and capacity in the Barkly region with community partners.",
                status: "Active",
                funding: "Funded",
                tags: ["Storytelling", "Truth-Telling"],
                lead: "Barkly Community Partners",
                beneficiaries: "Barkly region communities, local storytellers",
                practices: ["Community-led infrastructure", "Local capacity building", "Regional storytelling networks"],
                tests: ["Infrastructure effectiveness", "Community capacity growth", "Story sharing network strength"],
                stories: "Barkly community stories available"
            },
            {
                name: "Project Her Self",
                area: "Story & Sovereignty",
                description: "Storytelling project emphasizing truth-telling and community involvement, prioritizing community needs over external narratives.",
                status: "Active",
                funding: "Funded",
                tags: ["Truth-Telling", "Community"],
                lead: "Community Storytelling Collective",
                beneficiaries: "Women storytellers, community narrative control",
                practices: ["Community-prioritized storytelling", "Truth-telling protocols", "Narrative sovereignty"],
                tests: ["Community narrative control measurement", "Truth-telling impact assessment", "Storyteller empowerment tracking"],
                stories: "Women's empowerment stories available"
            },
            {
                name: "QFCC Empathy Ledger",
                area: "Story & Sovereignty",
                description: "Queensland Family and Child Commission initiative ensuring young people maintain ownership of their stories and influence decisions affecting their lives.",
                status: "Building",
                funding: "Needs Funding",
                tags: ["Youth Justice", "Data Sovereignty"],
                lead: "Queensland Family and Child Commission",
                beneficiaries: "Young people in care system, families",
                practices: ["Youth-controlled storytelling", "Decision influence protocols", "Story ownership protection"],
                tests: ["Youth story ownership verification", "Decision influence tracking", "System change measurement"],
                stories: "Young people's advocacy stories available"
            },
            {
                name: "Orange Sky Empathy Ledger",
                area: "Story & Sovereignty",
                description: "Successfully collected 108 stories emphasizing ethical storytelling and volunteer engagement with robust consent management.",
                status: "Active",
                funding: "Funded",
                tags: ["Storytelling", "Community Engagement"],
                lead: "Orange Sky Australia",
                beneficiaries: "Homeless community, volunteers",
                practices: ["Ethical storytelling protocols", "Robust consent management", "Volunteer engagement"],
                tests: ["Consent protocol effectiveness", "Story collection quality", "Community impact measurement"],
                stories: "Volunteer and community member stories available"
            },
            {
                name: "ACT Business Setup",
                area: "Operations & Infrastructure",
                description: "Creating dual-entity structure: ACT Foundation (grants) + ACT Ventures (profit-sharing) to ensure 40% of profits flow to communities.",
                status: "Building",
                funding: "Needs Funding",
                tags: ["Economic Freedom", "Decentralised Power", "Legal Structure"],
                lead: "ACT Leadership Team",
                beneficiaries: "Communities receiving profit-sharing, social enterprises",
                practices: ["Dual-entity governance", "Community profit-sharing", "Transparent financial flows"],
                tests: ["Profit-sharing mechanism effectiveness", "Community benefit tracking", "Legal structure optimization"],
                stories: "Community benefit recipient stories available"
            },
            {
                name: "ACT Notion Tool Audit",
                area: "Operations & Infrastructure",
                description: "Creating consistent knowledge database using PARA model, focusing on four main database tables for projects, tasks, and resources to enhance organization.",
                status: "Building",
                funding: "Self Funded",
                tags: ["Operations", "Creativity", "Knowledge Management"],
                lead: "ACT Operations Team",
                beneficiaries: "ACT team, partner organizations",
                practices: ["PARA methodology implementation", "Collaborative knowledge management", "Transparent information sharing"],
                tests: ["Knowledge accessibility improvement", "Team efficiency tracking", "Information sharing effectiveness"],
                stories: "Team productivity improvement stories available"
            },
            {
                name: "DGR Community Category Application",
                area: "Operations & Infrastructure",
                description: "Applying for DGR Community Charity status to enhance support for grassroots justice initiatives and facilitate funding for community-led solutions.",
                status: "Harvest",
                funding: "Needs Funding",
                tags: ["Operations", "Decentralised Power", "Legal Compliance"],
                lead: "ACT Legal and Operations Team",
                beneficiaries: "Grassroots justice initiatives, community organizations",
                practices: ["Community-focused charity model", "Grassroots funding facilitation", "Justice initiative support"],
                tests: ["DGR application success tracking", "Community funding increase measurement", "Grassroots support effectiveness"],
                stories: "Grassroots organization support stories available"
            },
            {
                name: "SAF Foundation Master",
                area: "Operations & Infrastructure",
                description: "Client-led collaboration project emphasizing decentralized power, currently active with focus on planning resources and stakeholder engagement.",
                status: "Active",
                funding: "Funded",
                tags: ["Operations", "Decentralised Power", "Client-Led"],
                lead: "SAF Foundation",
                beneficiaries: "Foundation stakeholders, community partners",
                practices: ["Client-led project management", "Decentralized decision-making", "Stakeholder engagement protocols"],
                tests: ["Client leadership effectiveness", "Stakeholder engagement quality", "Decentralized power distribution"],
                stories: "Client-led collaboration stories available"
            },
            {
                name: "Community Ownership Models",
                area: "Economic Freedom",
                description: "Developing frameworks for community ownership of digital platforms and ensuring profit-sharing mechanisms.",
                status: "Building",
                funding: "Needs Funding",
                tags: ["Economic Freedom", "Community Ownership", "Digital Rights"],
                lead: "Digital Commons Collective",
                beneficiaries: "Digital platform users, community stakeholders",
                practices: ["Community ownership frameworks", "Profit-sharing protocols", "Democratic platform governance"],
                tests: ["Ownership model effectiveness", "Profit distribution tracking", "Community control measurement"],
                stories: "Community platform ownership stories available"
            },
            {
                name: "Local Currency Initiative",
                area: "Economic Freedom",
                description: "Supporting communities in developing local exchange systems that keep value within the community.",
                status: "Active",
                funding: "Self Funded",
                tags: ["Economic Freedom", "Local Economy", "Community Resilience"],
                lead: "Local Economy Network",
                beneficiaries: "Local businesses, community members",
                practices: ["Local exchange system development", "Community value retention", "Economic resilience building"],
                tests: ["Local value retention tracking", "Community economic health", "Exchange system adoption"],
                stories: "Local economy transformation stories available"
            },
            {
                name: "Cooperative Development Program",
                area: "Economic Freedom",
                description: "Training and supporting communities to establish worker and consumer cooperatives.",
                status: "Active",
                funding: "Funded",
                tags: ["Economic Freedom", "Cooperatives", "Community Development"],
                lead: "Cooperative Development Alliance",
                beneficiaries: "Worker cooperatives, consumer cooperatives",
                practices: ["Cooperative education and training", "Democratic business governance", "Community economic development"],
                tests: ["Cooperative success rate tracking", "Worker ownership impact", "Community economic benefit"],
                stories: "Cooperative member empowerment stories available"
            },
            {
                name: "Community Engagement Platform",
                area: "Community Engagement",
                description: "Digital platform for facilitating community decision-making and participatory governance.",
                status: "Building",
                funding: "Needs Funding",
                tags: ["Community Engagement", "Digital Democracy", "Participation"],
                lead: "Digital Democracy Collective",
                beneficiaries: "Community organizations, civic groups",
                practices: ["Participatory decision-making tools", "Community governance facilitation", "Democratic engagement protocols"],
                tests: ["Community participation tracking", "Decision-making quality assessment", "Democratic engagement effectiveness"],
                stories: "Community democracy stories available"
            },
            {
                name: "Youth Leadership Program",
                area: "Community Engagement",
                description: "Empowering young people to lead community initiatives and develop leadership skills.",
                status: "Active",
                funding: "Funded",
                tags: ["Youth Development", "Leadership", "Community Engagement"],
                lead: "Youth Leadership Collective",
                beneficiaries: "Young community leaders, youth organizations",
                practices: ["Youth-led initiative development", "Leadership skill building", "Community engagement training"],
                tests: ["Youth leadership development tracking", "Community initiative success", "Leadership skill assessment"],
                stories: "Young leader transformation stories available"
            },
            {
                name: "Indigenous Data Sovereignty",
                area: "Story & Sovereignty",
                description: "Supporting Indigenous communities in maintaining control over their data and digital narratives.",
                status: "Building",
                funding: "Funded",
                tags: ["Indigenous Rights", "Data Sovereignty", "Digital Rights"],
                lead: "Indigenous Data Collective",
                beneficiaries: "Indigenous communities, traditional knowledge keepers",
                practices: ["Indigenous data governance", "Cultural protocol integration", "Community-controlled research"],
                tests: ["Data sovereignty implementation", "Cultural protocol effectiveness", "Community control measurement"],
                stories: "Indigenous data sovereignty stories available"
            },
            {
                name: "Community Land Back Initiative",
                area: "Economic Freedom",
                description: "Supporting communities in reclaiming and collectively owning land for housing and food production.",
                status: "Active",
                funding: "Community Owned",
                tags: ["Land Rights", "Community Ownership", "Housing Justice"],
                lead: "Land Back Collective",
                beneficiaries: "Displaced communities, housing-insecure families",
                practices: ["Community land acquisition", "Collective ownership models", "Affordable housing development"],
                tests: ["Land acquisition success tracking", "Community ownership sustainability", "Housing affordability impact"],
                stories: "Land reclamation and community ownership stories available"
            },
            {
                name: "Mutual Aid Networks",
                area: "Community Engagement",
                description: "Building resilient community support networks for crisis response and ongoing mutual support.",
                status: "Active",
                funding: "Community Owned",
                tags: ["Mutual Aid", "Community Resilience", "Crisis Response"],
                lead: "Mutual Aid Coordinators",
                beneficiaries: "Community members in need, crisis-affected populations",
                practices: ["Peer-to-peer support networks", "Resource sharing protocols", "Crisis response coordination"],
                tests: ["Network resilience assessment", "Crisis response effectiveness", "Community support impact"],
                stories: "Mutual aid transformation stories available"
            },
            {
                name: "Community Energy Cooperatives",
                area: "Economic Freedom",
                description: "Establishing community-owned renewable energy systems with democratic governance and profit-sharing.",
                status: "Building",
                funding: "Community Owned",
                tags: ["Energy Democracy", "Community Ownership", "Renewable Energy"],
                lead: "Energy Democracy Alliance",
                beneficiaries: "Community energy members, local households",
                practices: ["Democratic energy governance", "Community ownership models", "Renewable energy development"],
                tests: ["Energy cooperative viability", "Community ownership sustainability", "Democratic governance effectiveness"],
                stories: "Community energy ownership stories available"
            },
            {
                name: "Worker Cooperative Incubator",
                area: "Economic Freedom",
                description: "Supporting workers in transitioning businesses to cooperative ownership and democratic management.",
                status: "Active",
                funding: "Funded",
                tags: ["Worker Ownership", "Democratic Workplace", "Economic Justice"],
                lead: "Worker Cooperative Network",
                beneficiaries: "Workers transitioning to ownership, cooperative businesses",
                practices: ["Worker ownership education", "Democratic management training", "Cooperative business development"],
                tests: ["Worker ownership transition success", "Democratic management effectiveness", "Business sustainability tracking"],
                stories: "Worker ownership transformation stories available"
            },
            {
                name: "Community Food Sovereignty",
                area: "Community Engagement",
                description: "Building community-controlled food systems through urban farming, food cooperatives, and seed libraries.",
                status: "Active",
                funding: "Community Owned",
                tags: ["Food Sovereignty", "Urban Agriculture", "Community Control"],
                lead: "Food Sovereignty Collective",
                beneficiaries: "Community food producers, food-insecure families",
                practices: ["Community-controlled food production", "Cooperative food distribution", "Seed sovereignty programs"],
                tests: ["Food security improvement", "Community food control", "Local food system resilience"],
                stories: "Food sovereignty transformation stories available"
            },
            {
                name: "Digital Commons Platform",
                area: "Operations & Infrastructure",
                description: "Creating community-owned digital infrastructure for communication, organizing, and resource sharing.",
                status: "Building",
                funding: "Community Owned",
                tags: ["Digital Commons", "Community Infrastructure", "Platform Cooperatives"],
                lead: "Digital Commons Collective",
                beneficiaries: "Community organizations, digital platform users",
                practices: ["Community-owned platform development", "Democratic digital governance", "Open-source infrastructure"],
                tests: ["Platform adoption tracking", "Community ownership sustainability", "Democratic governance effectiveness"],
                stories: "Digital commons creation stories available"
            },
            {
                name: "Community Care Networks",
                area: "Community Engagement",
                description: "Building community-led care systems for childcare, eldercare, and disability support.",
                status: "Active",
                funding: "Community Owned",
                tags: ["Community Care", "Mutual Support", "Care Justice"],
                lead: "Community Care Collective",
                beneficiaries: "Families needing care support, care workers",
                practices: ["Community-led care coordination", "Mutual support networks", "Care worker cooperatives"],
                tests: ["Care network effectiveness", "Community care quality", "Care worker empowerment"],
                stories: "Community care transformation stories available"
            },
            {
                name: "Restorative Justice Circles",
                area: "Community Engagement",
                description: "Implementing community-led restorative justice practices as alternatives to punitive systems.",
                status: "Active",
                funding: "Funded",
                tags: ["Restorative Justice", "Community Healing", "Conflict Resolution"],
                lead: "Restorative Justice Collective",
                beneficiaries: "Community members in conflict, justice-involved individuals",
                practices: ["Community-led conflict resolution", "Healing-centered practices", "Restorative accountability"],
                tests: ["Conflict resolution effectiveness", "Community healing outcomes", "Recidivism reduction tracking"],
                stories: "Restorative justice healing stories available"
            }
        ];
        
        // Global state
        let allProjects = [];
        let filteredProjects = [];
        let activeArea = null;

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            loadNotionProjects();
        });

        // Refresh function for the refresh button
        async function refreshFromNotion() {
            const refreshBtn = document.getElementById('refresh-btn');
            refreshBtn.disabled = true;
            refreshBtn.textContent = 'Refreshing...';
            
            try {
                await loadNotionProjects();
                refreshBtn.textContent = 'Refreshed!';
                setTimeout(() => {
                    refreshBtn.textContent = 'Refresh from Notion';
                    refreshBtn.disabled = false;
                }, 2000);
            } catch (error) {
                console.error('Refresh failed:', error);
                refreshBtn.textContent = 'Refresh Failed';
                setTimeout(() => {
                    refreshBtn.textContent = 'Refresh from Notion';
                    refreshBtn.disabled = false;
                }, 2000);
            }
        }

        // Filter projects based on status and funding
        function filterProjects() {
            const statusFilter = document.getElementById('statusFilter').value;
            const fundingFilter = document.getElementById('fundingFilter').value;
            
            filteredProjects = allProjects.filter(project => {
                const statusMatch = statusFilter === 'all' || project.status === statusFilter;
                const fundingMatch = fundingFilter === 'all' || project.funding === fundingFilter;
                return statusMatch && fundingMatch;
            });
            
            updateAreaCounts();
            
            // If an area is currently active, refresh its display
            if (activeArea) {
                const areaName = Object.keys(areaMapping).find(key => areaMapping[key] === activeArea);
                if (areaName) {
                    renderProjectsForArea(areaName);
                }
            }
        }
        
        // Area mapping for cleaner URLs and IDs
        const areaMapping = {
            'Story & Sovereignty': 'story-sovereignty',
            'Economic Freedom': 'economic-freedom', 
            'Community Engagement': 'community-engagement',
            'Operations & Infrastructure': 'operations-infrastructure',
            'Research & Development': 'research-development'
        };
        
        function groupProjectsByArea(projectsToShow = allProjects) {
            const grouped = {};
            projectsToShow.forEach(project => {
                if (!grouped[project.area]) {
                    grouped[project.area] = [];
                }
                grouped[project.area].push(project);
            });
            return grouped;
        }
        
        function updateAreaCounts() {
            const groupedProjects = groupProjectsByArea(filteredProjects);
            
            // Update each area count
            Object.keys(areaMapping).forEach(areaName => {
                const areaId = areaMapping[areaName];
                const count = groupedProjects[areaName] ? groupedProjects[areaName].length : 0;
                const countElement = document.getElementById(`${areaId}-count`);
                if (countElement) {
                    countElement.textContent = `${count} projects`;
                }
            });
            
            // Update total count
            document.getElementById('projectCount').textContent = `${filteredProjects.length} total projects`;
        }
        
        function toggleMainArea(areaId) {
            // Clear previous active states
            document.querySelectorAll('.area-card').forEach(card => {
                card.classList.remove('active');
            });
            
            // If clicking the same area, close it
            if (activeArea === areaId) {
                activeArea = null;
                document.getElementById('projectsContainer').innerHTML = '';
                return;
            }
            
            // Set new active area
            activeArea = areaId;
            const clickedCard = event.currentTarget;
            clickedCard.classList.add('active');
            
            // Find the area name from the mapping
            const areaName = Object.keys(areaMapping).find(key => areaMapping[key] === areaId);
            
            // Render projects for this area
            renderProjectsForArea(areaName);
        }
        
        function createProjectHTML(project) {
            const statusClass = `status-${project.status?.toLowerCase().replace(/[^a-z]/g, '') || 'unknown'}`;
            const fundingClass = `funding-${project.funding?.toLowerCase().replace(/[^a-z]/g, '') || 'unknown'}`;
            
            // Format financial data
            const formatCurrency = (amount) => {
                if (!amount || amount === 0) return '';
                return `$${amount.toLocaleString()}`;
            };

            const revenueInfo = [];
            if (project.revenueActual > 0) revenueInfo.push(`Revenue: ${formatCurrency(project.revenueActual)}`);
            if (project.revenuePotential > 0) revenueInfo.push(`Potential: ${formatCurrency(project.revenuePotential)}`);
            if (project.actualIncoming > 0) revenueInfo.push(`Incoming: ${formatCurrency(project.actualIncoming)}`);

            return `
                <div class="project-item" onclick="toggleProjectDetails('${project.id}')">
                    <div class="project-header">
                        <div>
                            <div class="project-title">${project.name}</div>
                            ${project.location ? `<div class="meta-section"><strong>Location:</strong> ${project.location}</div>` : ''}
                            ${project.lead ? `<div class="meta-section"><strong>Lead:</strong> ${project.lead}</div>` : ''}
                        </div>
                        <div class="project-badges">
                            ${project.status ? `<span class="status ${statusClass}">${project.status}</span>` : ''}
                            ${project.funding ? `<span class="funding ${fundingClass}">${project.funding}</span>` : ''}
                        </div>
                    </div>
                    
                    ${project.aiSummary ? `<div class="project-description">${project.aiSummary}</div>` : ''}
                    ${project.description ? `<div class="project-description">${project.description}</div>` : ''}
                    
                    ${revenueInfo.length > 0 ? `<div class="meta-section"><strong>Financial:</strong> ${revenueInfo.join(' | ')}</div>` : ''}
                    ${project.nextMilestone ? `<div class="meta-section"><strong>Next Milestone:</strong> ${new Date(project.nextMilestone).toLocaleDateString()}</div>` : ''}
                    
                    <div class="tags">
                        ${project.themes ? project.themes.map(theme => `<span class="tag">${theme}</span>`).join('') : ''}
                        ${project.tags ? project.tags.map(tag => `<span class="tag">${tag}</span>`).join('') : ''}
                        ${project.coreValues ? `<span class="tag" style="background: #e3f2fd;">${project.coreValues}</span>` : ''}
                    </div>
                    
                    <div class="project-details" id="details-${project.id}">
                        ${project.place ? `<div class="meta-section"><strong>Stage:</strong> ${project.place}</div>` : ''}
                        ${project.state ? `<div class="meta-section"><strong>State:</strong> ${project.state}</div>` : ''}
                        ${project.url ? `<div class="meta-section"><strong>Notion:</strong> <a href="${project.url}" target="_blank">View in Notion</a></div>` : ''}
                        <div class="meta-section"><strong>Last Updated:</strong> ${new Date(project.lastModified).toLocaleDateString()}</div>
                    </div>
                </div>
            `;
        }

        function toggleProjectDetails(projectId) {
            const details = document.getElementById(`details-${projectId}`);
            if (details) {
                details.classList.toggle('show');
            }
        }

        function renderProjectsForArea(areaName) {
            const container = document.getElementById('projectsContainer');
            const areaProjects = filteredProjects.filter(project => project.area === areaName);
            
            if (areaProjects.length === 0) {
                container.innerHTML = `
                    <div class="no-projects">
                        <p>No projects found in ${areaName} with current filters.</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = `
                <div class="area-projects">
                    <h2>${areaName} Projects (${areaProjects.length})</h2>
                    <div class="projects-grid">
                        ${areaProjects.map(project => createProjectHTML(project)).join('')}
                    </div>
                </div>
            `;
                    </div>
                `;
                return;
            }
            
            container.innerHTML = `
                <div class="area-projects">
                    <h2>${areaName}</h2>
                    <div class="projects-grid">
                        ${areaProjects.map(project => createProjectHTML(project)).join('')}
                    </div>
                </div>
            `;
        }
        
        function createProjectHTML(project) {
             const statusClass = project.status === 'Active' ? 'status-active' : 
                               project.status === 'Building' ? 'status-building' : 'status-harvest';
             
             const fundingClass = project.funding === 'Funded' ? 'funding-funded' : 
                                project.funding === 'Needs Funding' ? 'funding-needs' : 
                                project.funding === 'Community Owned' ? 'funding-community' : 'funding-self';
             
             const projectId = project.name.replace(/\s+/g, '-').toLowerCase();
             
             return `
                 <div class="project-item" onclick="toggleProject('${projectId}')">
                     <div class="project-header">
                         <div class="project-title">${project.name}</div>
                         <div class="project-badges">
                             <span class="status ${statusClass}">${project.status}</span>
                             <span class="funding ${fundingClass}">${project.funding}</span>
                         </div>
                     </div>
                     <div class="project-description">${project.description}</div>
                     <div class="project-details" id="${projectId}-details">
                         <div class="project-meta">
                             <div class="meta-section">
                                 <strong>Led by:</strong> ${project.lead}
                             </div>
                             <div class="meta-section">
                                 <strong>Benefits:</strong> ${project.beneficiaries}
                             </div>
                         </div>
                         
                         <div class="practices-section">
                             <h4>How We Work:</h4>
                             <ul class="practices-list">
                                 ${project.practices.map(practice => `<li>${practice}</li>`).join('')}
                             </ul>
                         </div>
                         
                         <div class="tests-section">
                             <h4>Current Tests & Experiments:</h4>
                             <ul class="tests-list">
                                 ${project.tests.map(test => `<li>${test}</li>`).join('')}
                             </ul>
                         </div>
                         
                         <div class="stories-section">
                             <h4>Community Stories:</h4>
                             <p class="stories-note">${project.stories}</p>
                         </div>
                         
                         <div class="tags">
                             ${project.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                         </div>
                     </div>
                 </div>
             `;
         }
        
        // Notion MCP integration functions
        async function fetchFromNotion() {
            try {
                const notionProjects = await notionIntegration.getProjects();
                console.log('Notion API Response:', notionProjects);
                
                // If we get the limited mock data (2 projects), return null to keep rich fallback
                if (notionProjects && notionProjects.length <= 2 && notionProjects[0]?.id?.startsWith('mock-')) {
                    console.log('Notion returned mock data, keeping rich fallback');
                    return null;
                }
                
                // Log the comparison for debugging
                if (notionProjects && notionProjects.length > 0) {
                    console.log(`Notion returned ${notionProjects.length} projects vs ${projects.length} fallback projects`);
                    console.log('First Notion project:', notionProjects[0]);
                }
                
                return notionProjects;
            } catch (error) {
                console.error('Error fetching from Notion MCP:', error);
                return null; // Return null to keep rich fallback data
            }
        }

        async function refreshFromNotion() {
             const refreshBtn = document.getElementById('refresh-btn');
             refreshBtn.disabled = true;
             refreshBtn.textContent = 'Refreshing...';
            
            try {
                // Force refresh from Notion, bypassing any caching
                const notionData = await notionIntegration.refreshProjects();
                console.log('Force refresh - Notion data:', notionData);
                
                // Always use Notion data if we get a valid response, regardless of count
                if (notionData && Array.isArray(notionData)) {
                    allProjects = notionData;
                    filteredProjects = [...allProjects];
                    updateAreaCounts();
                    
                    console.log(`Updated with ${notionData.length} projects from Notion`);
                    
                    if (activeArea) {
                        const areaName = Object.keys(areaMapping).find(key => areaMapping[key] === activeArea);
                        if (areaName) {
                            renderProjectsForArea(areaName);
                        }
                    }
                    
                    refreshBtn.textContent = `Refreshed! (${notionData.length} projects)`;
                } else {
                    refreshBtn.textContent = 'No data from Notion';
                }
                
                setTimeout(() => {
                    refreshBtn.textContent = 'Refresh from Notion';
                    refreshBtn.disabled = false;
                }, 3000);
            } catch (error) {
                console.error('Failed to refresh from Notion:', error);
                refreshBtn.textContent = 'Refresh Failed';
                setTimeout(() => {
                    refreshBtn.textContent = 'Refresh from Notion';
                    refreshBtn.disabled = false;
                }, 3000);
            }
        }

        // Setup auto-refresh from Notion
        function setupNotionAutoRefresh() {
            return notionIntegration.setupAutoRefresh((updatedProjects, recentlyUpdated) => {
                console.log(`${recentlyUpdated.length} projects updated from Notion`);
                allProjects = updatedProjects;
                filteredProjects = [...allProjects];
                updateAreaCounts();
                
                if (activeArea) {
                    const areaName = Object.keys(areaMapping).find(key => areaMapping[key] === activeArea);
                    if (areaName) {
                        renderProjectsForArea(areaName);
                    }
                }
                
                // Show notification
                showUpdateNotification(recentlyUpdated.length);
            });
        }

        function showUpdateNotification(count) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #4CAF50;
                color: white;
                padding: 10px 20px;
                border-radius: 5px;
                z-index: 1000;
                font-size: 14px;
                box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            `;
            notification.textContent = `${count} project${count > 1 ? 's' : ''} updated from Notion`;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
        
        // Debug function to analyze current projects
        function analyzeProjects() {
            console.log('=== PROJECT ANALYSIS ===');
            console.log(`Total projects: ${allProjects.length}`);
            
            // Known real ACT projects
            const realACTProjects = [
                'Empathy Ledger', 'Wilya Janta Communications', 'ANAT SPECTRA 2025', 
                'Barkly Backbone', 'Project Her Self', 'QFCC Empathy Ledger', 
                'Orange Sky Empathy Ledger', 'ACT Business Setup', 'ACT Notion Tool Audit',
                'DGR Community Category Application', 'SAF Foundation Master'
            ];
            
            const realProjects = allProjects.filter(p => realACTProjects.includes(p.name));
            const possiblePlaceholders = allProjects.filter(p => !realACTProjects.includes(p.name));
            
            console.log(`Real ACT projects: ${realProjects.length}`);
             realProjects.forEach(p => console.log(`   ${p.name} (${p.area})`));
             
             console.log(`Possible placeholder projects: ${possiblePlaceholders.length}`);
             possiblePlaceholders.forEach(p => console.log(`  ? ${p.name} (${p.area})`));
            
            return { realProjects, possiblePlaceholders };
        }
        
        // Make debug function available globally
        window.analyzeProjects = analyzeProjects;
         
         function toggleProject(projectId) {
             event.stopPropagation();
             
             const details = document.getElementById(projectId + '-details');
             if (details) {
                 details.classList.toggle('show');
             }
         }
         
         function filterProjects() {
             const statusFilter = document.getElementById('statusFilter').value;
             const fundingFilter = document.getElementById('fundingFilter').value;
             
             filteredProjects = allProjects.filter(project => {
                 const statusMatch = statusFilter === 'all' || project.status === statusFilter;
                 const fundingMatch = fundingFilter === 'all' || project.funding === fundingFilter;
                 
                 return statusMatch && fundingMatch;
             });
             
             updateAreaCounts();
             
             // If an area is currently active, re-render its projects
             if (activeArea) {
                 const areaName = Object.keys(areaMapping).find(key => areaMapping[key] === activeArea);
                 if (areaName) {
                     renderProjectsForArea(areaName);
                 }
             }
         }
        
        // Initialize the application when page loads
        document.addEventListener('DOMContentLoaded', async function() {
            // Initialize with hardcoded data first
            allProjects = projects;
            filteredProjects = projects;
            updateAreaCounts();
            
            // Setup Notion MCP integration
             try {
                 setupNotionAutoRefresh();
                 
                 // Try to fetch fresh data from Notion
                 const notionData = await fetchFromNotion();
                 // Only use Notion data if it has more projects than our fallback
                 // This prevents the limited mock data from overriding our rich fallback
                 if (notionData && notionData.length > projects.length) {
                     allProjects = notionData;
                     filteredProjects = [...allProjects];
                     updateAreaCounts();
                     console.log('Successfully loaded projects from Notion MCP');
                 } else {
                     console.log('Using rich fallback data - Notion returned limited data');
                 }
             } catch (error) {
                 console.log('Notion MCP not available, using fallback data:', error);
             }
        });
        
        // Auto-refresh from Notion every 5 minutes (optional)
        // setInterval(refreshFromNotion, 5 * 60 * 1000);
    </script>
</body>
</html>