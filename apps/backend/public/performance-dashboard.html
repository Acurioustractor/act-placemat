<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ACT Platform - Performance Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .dashboard {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .header h1 {
            color: #2d3748;
            margin-bottom: 10px;
        }
        
        .last-updated {
            color: #718096;
            font-size: 14px;
        }
        
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .kpi-card {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        .kpi-value {
            font-size: 2.5em;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .kpi-label {
            color: #718096;
            text-transform: uppercase;
            font-size: 12px;
            letter-spacing: 1px;
        }
        
        .status-excellent { color: #38a169; }
        .status-good { color: #3182ce; }
        .status-warning { color: #d69e2e; }
        .status-critical { color: #e53e3e; }
        
        .content-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .panel h3 {
            color: #2d3748;
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        .compliance-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .compliance-item:last-child {
            border-bottom: none;
        }
        
        .compliance-score {
            font-weight: bold;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .alert-item {
            display: flex;
            align-items: center;
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            border-left: 4px solid;
        }
        
        .alert-critical {
            background: #fed7d7;
            border-color: #e53e3e;
        }
        
        .alert-warning {
            background: #fef5e7;
            border-color: #d69e2e;
        }
        
        .alert-info {
            background: #e6fffa;
            border-color: #3182ce;
        }
        
        .alert-icon {
            margin-right: 10px;
            font-size: 18px;
        }
        
        .alert-content {
            flex: 1;
        }
        
        .alert-time {
            color: #718096;
            font-size: 12px;
        }
        
        .refresh-btn {
            background: #4299e1;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s;
        }
        
        .refresh-btn:hover {
            background: #3182ce;
        }
        
        .refresh-btn:disabled {
            background: #a0aec0;
            cursor: not-allowed;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: #718096;
        }
        
        .error {
            background: #fed7d7;
            color: #c53030;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            display: none;
        }
        
        .chart-container {
            height: 200px;
            background: #f7fafc;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #718096;
            margin-top: 15px;
        }
        
        @media (max-width: 768px) {
            .content-grid {
                grid-template-columns: 1fr;
            }
            
            .kpi-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <div class="header">
            <h1>üöÄ ACT Platform Performance Dashboard</h1>
            <div class="last-updated" id="lastUpdated">Loading...</div>
            <button class="refresh-btn" id="refreshBtn" onclick="refreshDashboard()">üîÑ Refresh</button>
        </div>
        
        <div class="loading" id="loading">Loading performance metrics...</div>
        <div class="error" id="error"></div>
        
        <div id="dashboardContent" style="display: none;">
            <!-- KPI Cards -->
            <div class="kpi-grid">
                <div class="kpi-card">
                    <div class="kpi-label">Overall SLA Score</div>
                    <div class="kpi-value" id="overallScore">--</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">System Availability</div>
                    <div class="kpi-value" id="availability">--</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Avg Response Time</div>
                    <div class="kpi-value" id="responseTime">--</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Error Rate</div>
                    <div class="kpi-value" id="errorRate">--</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Data Freshness</div>
                    <div class="kpi-value" id="dataFreshness">--</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Active Alerts</div>
                    <div class="kpi-value" id="activeAlerts">--</div>
                </div>
            </div>
            
            <!-- Main Content Grid -->
            <div class="content-grid">
                <!-- Compliance Panel -->
                <div class="panel">
                    <h3>üìä SLA Compliance Breakdown</h3>
                    <div id="complianceBreakdown">
                        <div class="compliance-item">
                            <span>Data Freshness</span>
                            <span class="compliance-score" id="dataFreshnessScore">--</span>
                        </div>
                        <div class="compliance-item">
                            <span>API Performance</span>
                            <span class="compliance-score" id="apiPerformanceScore">--</span>
                        </div>
                        <div class="compliance-item">
                            <span>Data Quality</span>
                            <span class="compliance-score" id="dataQualityScore">--</span>
                        </div>
                        <div class="compliance-item">
                            <span>Processing Performance</span>
                            <span class="compliance-score" id="processingPerformanceScore">--</span>
                        </div>
                    </div>
                    
                    <div class="chart-container">
                        üìà Performance Trends Chart
                        <br><small>(Historical data visualization)</small>
                    </div>
                </div>
                
                <!-- Alerts Panel -->
                <div class="panel">
                    <h3>üö® Recent Alerts</h3>
                    <div id="alertsList">
                        <!-- Alerts will be populated here -->
                    </div>
                </div>
            </div>
            
            <!-- Executive Summary -->
            <div class="panel">
                <h3>üìã Executive Summary</h3>
                <div id="executiveSummary">
                    <!-- Summary will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        let refreshInterval;
        
        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboard();
            
            // Auto-refresh every 5 minutes
            refreshInterval = setInterval(loadDashboard, 5 * 60 * 1000);
        });
        
        async function loadDashboard() {
            try {
                showLoading(true);
                hideError();
                
                const response = await fetch('/api/performance-dashboard/overview');
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                if (!data.success) {
                    throw new Error('Failed to load dashboard data');
                }
                
                populateDashboard(data.dashboard_overview);
                showLoading(false);
                document.getElementById('dashboardContent').style.display = 'block';
                
            } catch (error) {
                console.error('Dashboard load error:', error);
                showError('Failed to load dashboard: ' + error.message);
                showLoading(false);
            }
        }
        
        function populateDashboard(overview) {
            // Update last updated time
            document.getElementById('lastUpdated').textContent = 
                'Last updated: ' + new Date(overview.last_updated).toLocaleString();
            
            // Update KPIs
            updateKPI('overallScore', overview.kpis.overall_sla_score, '%', overview.kpis.overall_sla_score);
            updateKPI('availability', overview.kpis.system_availability, '%', overview.kpis.system_availability);
            updateKPI('responseTime', overview.kpis.avg_response_time, 'ms', overview.kpis.avg_response_time);
            updateKPI('errorRate', overview.kpis.error_rate, '%', overview.kpis.error_rate);
            updateKPI('dataFreshness', overview.kpis.data_freshness_compliance, '%', overview.kpis.data_freshness_compliance);
            updateKPI('activeAlerts', overview.kpis.active_alerts, '', overview.kpis.active_alerts);
            
            // Update compliance breakdown
            updateComplianceScore('dataFreshnessScore', overview.compliance_breakdown.data_freshness);
            updateComplianceScore('apiPerformanceScore', overview.compliance_breakdown.api_performance);
            updateComplianceScore('dataQualityScore', overview.compliance_breakdown.data_quality);
            updateComplianceScore('processingPerformanceScore', overview.compliance_breakdown.processing_performance);
            
            // Update alerts
            populateAlerts(overview.alerts);
            
            // Update executive summary
            populateExecutiveSummary(overview.executive_summary);
        }
        
        function updateKPI(elementId, value, unit, score) {
            const element = document.getElementById(elementId);
            element.textContent = value + unit;
            
            // Apply status coloring
            element.className = 'kpi-value ' + getStatusClass(score);
        }
        
        function updateComplianceScore(elementId, compliance) {
            const element = document.getElementById(elementId);
            element.textContent = Math.round(compliance.score) + '%';
            element.className = 'compliance-score ' + getStatusClass(compliance.score);
        }
        
        function getStatusClass(score) {
            if (score >= 95) return 'status-excellent';
            if (score >= 85) return 'status-good';
            if (score >= 70) return 'status-warning';
            return 'status-critical';
        }
        
        function populateAlerts(alertStats) {
            const alertsList = document.getElementById('alertsList');
            
            if (alertStats.unacknowledged === 0) {
                alertsList.innerHTML = '<div style="text-align: center; color: #38a169; padding: 20px;">‚úÖ No active alerts</div>';
                return;
            }
            
            // Create summary of alerts
            alertsList.innerHTML = `
                <div class="alert-item alert-${alertStats.critical > 0 ? 'critical' : alertStats.warning > 0 ? 'warning' : 'info'}">
                    <div class="alert-icon">${alertStats.critical > 0 ? 'üö®' : alertStats.warning > 0 ? '‚ö†Ô∏è' : '‚ÑπÔ∏è'}</div>
                    <div class="alert-content">
                        <strong>${alertStats.unacknowledged} Unacknowledged Alerts</strong>
                        <div class="alert-time">
                            Critical: ${alertStats.critical}, Warning: ${alertStats.warning}, Info: ${alertStats.info}
                        </div>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 15px;">
                    <button class="refresh-btn" onclick="window.open('/api/sla-monitoring/alerts', '_blank')">
                        View All Alerts
                    </button>
                </div>
            `;
        }
        
        function populateExecutiveSummary(summary) {
            const summaryElement = document.getElementById('executiveSummary');
            
            if (!summary || summary.length === 0) {
                summaryElement.innerHTML = '<p style="color: #718096;">No executive summary available.</p>';
                return;
            }
            
            const summaryHTML = summary.map(item => `<p style="margin: 10px 0;">${item}</p>`).join('');
            summaryElement.innerHTML = summaryHTML;
        }
        
        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
            document.getElementById('refreshBtn').disabled = show;
        }
        
        function showError(message) {
            const errorElement = document.getElementById('error');
            errorElement.textContent = message;
            errorElement.style.display = 'block';
        }
        
        function hideError() {
            document.getElementById('error').style.display = 'none';
        }
        
        function refreshDashboard() {
            loadDashboard();
        }
        
        // Handle page visibility changes
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                clearInterval(refreshInterval);
            } else {
                loadDashboard();
                refreshInterval = setInterval(loadDashboard, 5 * 60 * 1000);
            }
        });
    </script>
</body>
</html>